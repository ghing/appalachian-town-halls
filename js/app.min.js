(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.TownHalls = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var MeetingStore = function () {
  function MeetingStore() {
    _classCallCheck(this, MeetingStore);

    this._meetings = [];
    this._meetingsByDate = {};
    this._meetingsByOfficial = {};
    this._meetingsByDivision = {};
    this._officials = [];
  }

  _createClass(MeetingStore, [{
    key: "setOfficials",
    value: function setOfficials(officials) {
      this._officials = officials;
      this._setMeetingsFromOfficials(this._officials);
    }
  }, {
    key: "getOfficials",
    value: function getOfficials() {
      return this._officials;
    }
  }, {
    key: "_setMeetingsFromOfficials",
    value: function _setMeetingsFromOfficials(officials) {
      var _this = this;

      var sort = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

      this._meetings = [];
      this._meetingsByDate = {};

      officials.forEach(function (official) {
        official.meetings.forEach(function (meeting) {
          meeting.official = official;
          _this.addMeeting(meeting);
        });
      });

      if (sort) {
        this._sortMeetingsByDate();
      }

      return this;
    }
  }, {
    key: "_sortMeetingsByDate",
    value: function _sortMeetingsByDate() {
      this._meetings.sort(function (a, b) {
        if (a.date > b.date) {
          return -1;
        }

        if (a.date < b.date) {
          return 1;
        }

        return 0;
      });
    }
  }, {
    key: "addMeeting",
    value: function addMeeting(meeting) {
      this._meetings.push(meeting);

      if (!this._meetingsByDate[meeting.date]) {
        this._meetingsByDate[meeting.date] = [];
      }
      this._meetingsByDate[meeting.date].push(meeting);

      if (!this._meetingsByOfficial[meeting.official.id]) {
        this._meetingsByOfficial[meeting.official.id] = [];
      }
      this._meetingsByOfficial[meeting.official.id].push(meeting);

      var ocdId = meeting.official.office.division.ocd_id;
      if (!this._meetingsByDivision[ocdId]) {
        this._meetingsByDivision[ocdId] = [];
      }
      this._meetingsByDivision[ocdId].push(meeting);

      return this;
    }
  }, {
    key: "getMeetings",
    value: function getMeetings() {
      return this._meetings;
    }
  }, {
    key: "getMeetingsForDate",
    value: function getMeetingsForDate(date, filter) {
      var meetings = this._meetingsByDate[date];
      if (!meetings) {
        return [];
      }

      if (filter) {
        return meetings.filter(filter);
      }

      return meetings;
    }
  }, {
    key: "getMeetingsForOfficial",
    value: function getMeetingsForOfficial(officialId) {
      return this._meetingsByOfficial[officialId];
    }
  }, {
    key: "getMeetingsForDivision",
    value: function getMeetingsForDivision(ocdId) {
      return this._meetingsByDivision[ocdId];
    }
  }]);

  return MeetingStore;
}();

exports.default = MeetingStore;

},{}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.App = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _d = require('d3');

var d3 = _interopRequireWildcard(_d);

var _MeetingStore = require('./MeetingStore');

var _MeetingStore2 = _interopRequireDefault(_MeetingStore);

var _timeline = require('./timeline');

var _timeline2 = _interopRequireDefault(_timeline);

var _repsearch = require('./repsearch');

var _repsearch2 = _interopRequireDefault(_repsearch);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var DEFAULT_LABELS = {
  noDistrictFound: "Could not find a district matching this address",
  multipleDistrictsFound: "Found more than one districts matching this address"
};

var App = exports.App = function () {
  function App(options) {
    var _this = this;

    _classCallCheck(this, App);

    this._timelineContainer = options.timelineContainer;
    this._repSearchContainer = options.repSearchContainer;
    this._googleApiKey = options.googleApiKey;
    this._labels = options.labels || DEFAULT_LABELS;
    this._meetingStore = new _MeetingStore2.default();
    this._startDate = options.startDate || new Date(2017, 0, 20);
    this._endDate = options.endDate || new Date();
    this._annotations = options.annotations || {
      "2017-01-20": {
        label: "Inauguration day"
      },
      "2017-02-20": {
        label: "District work period begins"
      },
      "2017-02-24": {
        label: "District work period ends"
      },
      "2017-04-10": {
        label: "District work period begins"
      },
      "2017-04-21": {
        label: "District work period ends"
      }
    };

    // Explicitely bind this method to the instance so that we can access
    // `this` when the method is used as a callback
    this._handleAddress = this._handleAddress.bind(this);
    this._handleReset = this._handleReset.bind(this);

    // Construct some d3 components
    this._timeline = (0, _timeline2.default)();
    this._search = (0, _repsearch2.default)().handleAddress(this._handleAddress).handleReset(this._handleReset);

    // These are the state variables
    this._allDays = [];
    this._searchAddress = null;

    d3.json(options.officialMeetingsJsonUrl, function (data) {
      _this._meetingStore.setOfficials(data.objects);
      _this._allDays = _this._meetingsByDay(_this._meetingStore, _this._startDate, _this._endDate, _this._annotations);

      _this._renderTimeline(_this._allDays);

      d3.select(_this._repSearchContainer).call(_this._search);
    });
  }

  _createClass(App, [{
    key: '_handleReset',
    value: function _handleReset() {
      if (this._searchAddress !== null) {
        this._renderTimeline(this._allDays);
      }
    }
  }, {
    key: '_renderTimeline',
    value: function _renderTimeline(days) {
      d3.select(this._timelineContainer).datum(days).call(this._timeline);
    }
  }, {
    key: '_handleAddress',
    value: function _handleAddress(address, callback) {
      var _this2 = this;

      this._searchAddress = address;

      // Use the Google Civic Information API to lookup the U.S. Representative
      // for an address.
      //
      // See https://developers.google.com/civic-information/docs/v2/representatives/representativeInfoByAddress
      // for API docs.
      // A few quick notes:
      //
      // We just need to look up reps by their district, so we just need the
      // political division and not data about offices.  We exclude office data
      // by specifying `includeOffices=false`
      //
      // `levels=country` and `roles=legislatorLowerBody` specifies that we only
      // care about the house.
      var url = 'https://content.googleapis.com/civicinfo/v2/representatives?address=' + encodeURIComponent(address) + '&includeOffices=false&levels=country&roles=legislatorLowerBody&alt=json&key=' + this._googleApiKey;

      d3.json(url, function (data) {
        // Divisions is an object keyed by OCD ID. We need a list of these IDs.
        var divisions = Object.keys(data.divisions);

        // There should be one and only one congressional district for an address
        if (divisions.length != 1) {
          callback({
            msg: division.length == 0 ? _this2._labels.noDistrictFound : _this2._labels.multipleDistrictsFound
          }, null);
        }

        // Success.  Tell the form.
        callback(null, {
          ocdId: divisions[0],
          name: data.divisions[divisions[0]].name
        });

        var meetingIds = _this2._meetingStore.getMeetingsForDivision(divisions[0]).reduce(function (lookup, meeting) {
          lookup[meeting.id] = true;
          return lookup;
        }, {});
        var days = _this2._meetingsByDay(_this2._meetingStore, _this2._startDate, _this2._endDate, _this2._annotations, function (meeting) {
          return meetingIds[meeting.id];
        });
        _this2._renderTimeline(days);
      });
    }
  }, {
    key: '_meetingsByDay',
    value: function _meetingsByDay(meetingStore, startDate, endDate, annotations, filter) {
      var days = [];
      var format = d3.timeFormat("%Y-%m-%d");

      d3.timeDay.range(startDate, endDate, 1).forEach(function (date, i) {
        var dateStr = format(date);
        var meetings = meetingStore.getMeetingsForDate(dateStr, filter);

        if (meetings.length == 0 && !annotations[dateStr]) {
          return;
        }

        days.push({
          day: i + 1,
          date: date,
          meetings: meetings,
          label: annotations[dateStr] ? annotations[dateStr].label : null
        });
      });

      return days.reverse();
    }
  }]);

  return App;
}();

},{"./MeetingStore":1,"./repsearch":3,"./timeline":4,"d3":"d3"}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = repSearch;

var _d = require('d3');

var d3 = _interopRequireWildcard(_d);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function repSearch() {
  var handleAddress = function handleAddress() {};
  var handleReset = function handleReset() {};
  var messages = null;

  var receiveResponse = function receiveResponse(err, data) {
    if (err) {
      messages.text(err.msg);
      return;
    }

    var message = 'This address is in ' + data.name + '.';
    messages.text(message);
  };

  var handleSubmit = function handleSubmit() {
    d3.event.preventDefault();

    var form = d3.select(d3.event.target);
    var address = form.select('.representative-search-form__address-input').node().value;

    if (!address) {
      // Don't allow an empty address
      return false;
    }

    messages = form.select('.representative-search-form__messages');
    handleAddress(address, receiveResponse);
  };

  var search = function search(selection) {
    selection.each(function () {
      var sel = d3.select(this);

      sel.selectAll('*').remove();

      var form = sel.append('form').attr('class', 'representative-search-form').on('submit', handleSubmit);

      form.append('input').attr('type', 'text').attr('class', 'representative-search-form__address-input').attr('placeholder', "Enter your address");

      form.append('button').attr('type', 'submit').text("Find your representative").attr('class', 'representative-search-form__btn representative-search-form__btn--submit');

      form.append('button').attr('type', 'reset').text("Start over").on('click', function () {
        messages.text("");
        messages.selectAll('*').remove();
        handleReset();
      }).attr('class', 'representative-search-form__btn representative-search-form__btn--reset');

      form.append('div').attr('class', 'representative-search-form__messages');
    });
  };

  search.handleAddress = function (val) {
    if (!val) {
      return handleAddress;
    }

    handleAddress = val;
    return this;
  };

  search.handleReset = function (val) {
    if (!val) {
      return handleReset;
    }

    handleReset = val;
    return this;
  };

  return search;
}

},{"d3":"d3"}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = meetingTimeline;

var _d = require("d3");

var d3 = _interopRequireWildcard(_d);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function ocdIdToDistrict(ocdId) {
  var bits = ocdId.split(':');
  var state = bits[bits.length - 2].slice(0, 2).toUpperCase();
  var district = bits[bits.length - 1];
  return state + "-" + district;
}

function officialDistrict(official) {
  return ocdIdToDistrict(official.office.division.ocd_id);
}

function meetingsByOfficial(meetings) {
  var byOfficial = meetings.reduce(function (lookup, meeting) {
    if (!lookup[meeting.official.id]) {
      lookup[meeting.official.id] = {
        official: meeting.official,
        meetings: []
      };
    }
    lookup[meeting.official.id].meetings.push(meeting);
    return lookup;
  }, {});

  return d3.values(byOfficial);
}

function getPartyLabel(party) {
  if (party == "Republican") {
    return "R";
  } else if (party == "Democratic") {
    return "D";
  }
}

function renderOfficial(sel) {
  sel.each(function (d) {
    var el = d3.select(this);

    var partyLabel = getPartyLabel(d.official.party);
    var officialClass = "timeline__meeting__official";
    if (partyLabel) {
      officialClass += " timeline__meeting__official--" + partyLabel.toLowerCase();
    }

    el.append('span').attr('class', officialClass).text(d.official.name);

    if (partyLabel) {
      el.append('span').attr('class', 'timeline__meeting__party timeline__meeting__party--' + partyLabel.toLowerCase()).text(" (" + partyLabel + ")");
    }

    el.append('span').attr('class', 'timeline__meeting__district').text(" (" + officialDistrict(d.official) + ")");

    if (d.meetings.length == 1) {
      if (d.meetings[0].meeting_type == "telephone") {
        el.append('span').attr('class', 'timeline__meeting__type timeline__meeting__type--telephone').text(" \u260E");
      } else if (d.meetings[0].meeting_type == "facebook") {
        el.append('span').attr('class', 'timeline__meeting__type timeline__meeting__type--facebook').text(" f");
      } else if (d.meetings[0].meeting_type == "radio") {
        el.append('span').attr('class', 'timeline__meeting__type timeline__meeting__type--radio').text(" \u1F4FB");
      }
    }

    if (d.meetings.length > 1) {
      el.append('span').attr('class', 'timeline__meeting__count').text(" x" + d.meetings.length);
    }
  });
}

function renderDay(sel, dateFormat) {
  sel.append('h2').attr('class', 'timeline__day__number').text(function (d) {
    return d.day;
  });

  sel.append('div').attr('class', 'timeline__day__date').text(function (d) {
    return dateFormat(d.date);
  });

  sel.append('div').attr('class', 'timeline__day__label').text(function (d) {
    return d.label;
  });

  sel.selectAll('.timeline__meeting').data(function (d) {
    return meetingsByOfficial(d.meetings);
  }).enter().append('div').attr('class', 'timeline__meeting').call(renderOfficial);
}

function meetingTimeline() {
  var dateFormat = d3.timeFormat("%B %d, %Y");

  function timeline(selection) {
    selection.each(function (days) {
      var container = d3.select(this);
      container.selectAll('*').remove();

      var timeline = container.append('div').attr('class', 'timeline');

      timeline.selectAll('.timeline__day').data(days).enter().append('div').attr('class', 'timeline__day').call(renderDay, dateFormat);
    });
  }

  return timeline;
}

},{"d3":"d3"}]},{},[2])(2)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwianMvc3JjL01lZXRpbmdTdG9yZS5qcyIsImpzL3NyYy9hcHAuanMiLCJqcy9zcmMvcmVwc2VhcmNoLmpzIiwianMvc3JjL3RpbWVsaW5lLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztJQ0FNLFk7QUFDSiwwQkFBYztBQUFBOztBQUNaLFNBQUssU0FBTCxHQUFpQixFQUFqQjtBQUNBLFNBQUssZUFBTCxHQUF1QixFQUF2QjtBQUNBLFNBQUssbUJBQUwsR0FBMkIsRUFBM0I7QUFDQSxTQUFLLG1CQUFMLEdBQTJCLEVBQTNCO0FBQ0EsU0FBSyxVQUFMLEdBQWtCLEVBQWxCO0FBQ0Q7Ozs7aUNBRVksUyxFQUFXO0FBQ3RCLFdBQUssVUFBTCxHQUFrQixTQUFsQjtBQUNBLFdBQUsseUJBQUwsQ0FBK0IsS0FBSyxVQUFwQztBQUNEOzs7bUNBRWM7QUFDYixhQUFPLEtBQUssVUFBWjtBQUNEOzs7OENBRXlCLFMsRUFBd0I7QUFBQTs7QUFBQSxVQUFiLElBQWEsdUVBQU4sSUFBTTs7QUFDaEQsV0FBSyxTQUFMLEdBQWlCLEVBQWpCO0FBQ0EsV0FBSyxlQUFMLEdBQXVCLEVBQXZCOztBQUVBLGdCQUFVLE9BQVYsQ0FBa0Isb0JBQVk7QUFDNUIsaUJBQVMsUUFBVCxDQUFrQixPQUFsQixDQUEwQixtQkFBVztBQUNuQyxrQkFBUSxRQUFSLEdBQW1CLFFBQW5CO0FBQ0EsZ0JBQUssVUFBTCxDQUFnQixPQUFoQjtBQUNELFNBSEQ7QUFJRCxPQUxEOztBQU9BLFVBQUksSUFBSixFQUFVO0FBQ1IsYUFBSyxtQkFBTDtBQUNEOztBQUVELGFBQU8sSUFBUDtBQUNEOzs7MENBRXFCO0FBQ3BCLFdBQUssU0FBTCxDQUFlLElBQWYsQ0FBb0IsVUFBQyxDQUFELEVBQUksQ0FBSixFQUFVO0FBQzVCLFlBQUksRUFBRSxJQUFGLEdBQVMsRUFB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bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjbGFzcyBNZWV0aW5nU3RvcmUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9tZWV0aW5ncyA9IFtdO1xuICAgIHRoaXMuX21lZXRpbmdzQnlEYXRlID0ge307XG4gICAgdGhpcy5fbWVldGluZ3NCeU9mZmljaWFsID0ge307XG4gICAgdGhpcy5fbWVldGluZ3NCeURpdmlzaW9uID0ge307XG4gICAgdGhpcy5fb2ZmaWNpYWxzID0gW107XG4gIH1cblxuICBzZXRPZmZpY2lhbHMob2ZmaWNpYWxzKSB7XG4gICAgdGhpcy5fb2ZmaWNpYWxzID0gb2ZmaWNpYWxzO1xuICAgIHRoaXMuX3NldE1lZXRpbmdzRnJvbU9mZmljaWFscyh0aGlzLl9vZmZpY2lhbHMpO1xuICB9XG5cbiAgZ2V0T2ZmaWNpYWxzKCkge1xuICAgIHJldHVybiB0aGlzLl9vZmZpY2lhbHM7XG4gIH1cblxuICBfc2V0TWVldGluZ3NGcm9tT2ZmaWNpYWxzKG9mZmljaWFscywgc29ydCA9IHRydWUpIHtcbiAgICB0aGlzLl9tZWV0aW5ncyA9IFtdO1xuICAgIHRoaXMuX21lZXRpbmdzQnlEYXRlID0ge307XG5cbiAgICBvZmZpY2lhbHMuZm9yRWFjaChvZmZpY2lhbCA9PiB7XG4gICAgICBvZmZpY2lhbC5tZWV0aW5ncy5mb3JFYWNoKG1lZXRpbmcgPT4ge1xuICAgICAgICBtZWV0aW5nLm9mZmljaWFsID0gb2ZmaWNpYWw7XG4gICAgICAgIHRoaXMuYWRkTWVldGluZyhtZWV0aW5nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaWYgKHNvcnQpIHtcbiAgICAgIHRoaXMuX3NvcnRNZWV0aW5nc0J5RGF0ZSgpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgX3NvcnRNZWV0aW5nc0J5RGF0ZSgpIHtcbiAgICB0aGlzLl9tZWV0aW5ncy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBpZiAoYS5kYXRlID4gYi5kYXRlKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cblxuICAgICAgaWYgKGEuZGF0ZSA8IGIuZGF0ZSkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIDA7XG4gICAgfSk7XG4gIH1cblxuICBhZGRNZWV0aW5nKG1lZXRpbmcpIHtcbiAgICB0aGlzLl9tZWV0aW5ncy5wdXNoKG1lZXRpbmcpO1xuXG4gICAgaWYgKCF0aGlzLl9tZWV0aW5nc0J5RGF0ZVttZWV0aW5nLmRhdGVdKSB7XG4gICAgICB0aGlzLl9tZWV0aW5nc0J5RGF0ZVttZWV0aW5nLmRhdGVdID0gW107XG4gICAgfVxuICAgIHRoaXMuX21lZXRpbmdzQnlEYXRlW21lZXRpbmcuZGF0ZV0ucHVzaChtZWV0aW5nKTtcblxuICAgIGlmICghdGhpcy5fbWVldGluZ3NCeU9mZmljaWFsW21lZXRpbmcub2ZmaWNpYWwuaWRdKSB7XG4gICAgICB0aGlzLl9tZWV0aW5nc0J5T2ZmaWNpYWxbbWVldGluZy5vZmZpY2lhbC5pZF0gPSBbXTtcbiAgICB9XG4gICAgdGhpcy5fbWVldGluZ3NCeU9mZmljaWFsW21lZXRpbmcub2ZmaWNpYWwuaWRdLnB1c2gobWVldGluZyk7XG5cbiAgICBjb25zdCBvY2RJZCA9IG1lZXRpbmcub2ZmaWNpYWwub2ZmaWNlLmRpdmlzaW9uLm9jZF9pZDtcbiAgICBpZiAoIXRoaXMuX21lZXRpbmdzQnlEaXZpc2lvbltvY2RJZF0pIHtcbiAgICAgIHRoaXMuX21lZXRpbmdzQnlEaXZpc2lvbltvY2RJZF0gPSBbXTtcbiAgICB9XG4gICAgdGhpcy5fbWVldGluZ3NCeURpdmlzaW9uW29jZElkXS5wdXNoKG1lZXRpbmcpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBnZXRNZWV0aW5ncygpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVldGluZ3M7XG4gIH1cblxuICBnZXRNZWV0aW5nc0ZvckRhdGUoZGF0ZSwgZmlsdGVyKSB7XG4gICAgY29uc3QgbWVldGluZ3MgPSB0aGlzLl9tZWV0aW5nc0J5RGF0ZVtkYXRlXTtcbiAgICBpZiAoIW1lZXRpbmdzKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcikge1xuICAgICAgcmV0dXJuIG1lZXRpbmdzLmZpbHRlcihmaWx0ZXIpO1xuICAgIH1cblxuICAgIHJldHVybiBtZWV0aW5ncztcbiAgfVxuXG4gIGdldE1lZXRpbmdzRm9yT2ZmaWNpYWwob2ZmaWNpYWxJZCkge1xuICAgIHJldHVybiB0aGlzLl9tZWV0aW5nc0J5T2ZmaWNpYWxbb2ZmaWNpYWxJZF07XG4gIH1cblxuICBnZXRNZWV0aW5nc0ZvckRpdmlzaW9uKG9jZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lZXRpbmdzQnlEaXZpc2lvbltvY2RJZF07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTWVldGluZ1N0b3JlO1xuIiwiaW1wb3J0ICogYXMgZDMgZnJvbSBcImQzXCI7XG5cbmltcG9ydCBNZWV0aW5nU3RvcmUgZnJvbSAnLi9NZWV0aW5nU3RvcmUnO1xuaW1wb3J0IG1lZXRpbmdUaW1lbGluZSBmcm9tICcuL3RpbWVsaW5lJztcbmltcG9ydCByZXBTZWFyY2ggZnJvbSAnLi9yZXBzZWFyY2gnO1xuXG5jb25zdCBERUZBVUxUX0xBQkVMUyA9IHtcbiAgbm9EaXN0cmljdEZvdW5kOiBcIkNvdWxkIG5vdCBmaW5kIGEgZGlzdHJpY3QgbWF0Y2hpbmcgdGhpcyBhZGRyZXNzXCIsXG4gIG11bHRpcGxlRGlzdHJpY3RzRm91bmQ6IFwiRm91bmQgbW9yZSB0aGFuIG9uZSBkaXN0cmljdHMgbWF0Y2hpbmcgdGhpcyBhZGRyZXNzXCJcbn07XG5cbmV4cG9ydCBjbGFzcyBBcHAge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5fdGltZWxpbmVDb250YWluZXIgPSBvcHRpb25zLnRpbWVsaW5lQ29udGFpbmVyO1xuICAgIHRoaXMuX3JlcFNlYXJjaENvbnRhaW5lciA9IG9wdGlvbnMucmVwU2VhcmNoQ29udGFpbmVyO1xuICAgIHRoaXMuX2dvb2dsZUFwaUtleSA9IG9wdGlvbnMuZ29vZ2xlQXBpS2V5O1xuICAgIHRoaXMuX2xhYmVscyA9IG9wdGlvbnMubGFiZWxzIHx8IERFRkFVTFRfTEFCRUxTO1xuICAgIHRoaXMuX21lZXRpbmdTdG9yZSA9IG5ldyBNZWV0aW5nU3RvcmUoKTtcbiAgICB0aGlzLl9zdGFydERhdGUgPSBvcHRpb25zLnN0YXJ0RGF0ZSB8fCBuZXcgRGF0ZSgyMDE3LCAwLCAyMCk7XG4gICAgdGhpcy5fZW5kRGF0ZSA9IG9wdGlvbnMuZW5kRGF0ZSB8fCBuZXcgRGF0ZSgpO1xuICAgIHRoaXMuX2Fubm90YXRpb25zID0gb3B0aW9ucy5hbm5vdGF0aW9ucyB8fCB7XG4gICAgICBcIjIwMTctMDEtMjBcIjoge1xuICAgICAgICBsYWJlbDogXCJJbmF1Z3VyYXRpb24gZGF5XCJcbiAgICAgIH0sXG4gICAgICBcIjIwMTctMDItMjBcIjoge1xuICAgICAgICBsYWJlbDogXCJEaXN0cmljdCB3b3JrIHBlcmlvZCBiZWdpbnNcIlxuICAgICAgfSxcbiAgICAgIFwiMjAxNy0wMi0yNFwiOiB7XG4gICAgICAgIGxhYmVsOiBcIkRpc3RyaWN0IHdvcmsgcGVyaW9kIGVuZHNcIlxuICAgICAgfSxcbiAgICAgIFwiMjAxNy0wNC0xMFwiOiB7XG4gICAgICAgIGxhYmVsOiBcIkRpc3RyaWN0IHdvcmsgcGVyaW9kIGJlZ2luc1wiXG4gICAgICB9LFxuICAgICAgXCIyMDE3LTA0LTIxXCI6IHtcbiAgICAgICAgbGFiZWw6IFwiRGlzdHJpY3Qgd29yayBwZXJpb2QgZW5kc1wiXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIEV4cGxpY2l0ZWx5IGJpbmQgdGhpcyBtZXRob2QgdG8gdGhlIGluc3RhbmNlIHNvIHRoYXQgd2UgY2FuIGFjY2Vzc1xuICAgIC8vIGB0aGlzYCB3aGVuIHRoZSBtZXRob2QgaXMgdXNlZCBhcyBhIGNhbGxiYWNrXG4gICAgdGhpcy5faGFuZGxlQWRkcmVzcyA9IHRoaXMuX2hhbmRsZUFkZHJlc3MuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9oYW5kbGVSZXNldCA9IHRoaXMuX2hhbmRsZVJlc2V0LmJpbmQodGhpcyk7XG5cbiAgICAvLyBDb25zdHJ1Y3Qgc29tZSBkMyBjb21wb25lbnRzXG4gICAgdGhpcy5fdGltZWxpbmUgPSBtZWV0aW5nVGltZWxpbmUoKTtcbiAgICB0aGlzLl9zZWFyY2ggPSByZXBTZWFyY2goKVxuICAgICAgLmhhbmRsZUFkZHJlc3ModGhpcy5faGFuZGxlQWRkcmVzcylcbiAgICAgIC5oYW5kbGVSZXNldCh0aGlzLl9oYW5kbGVSZXNldCk7XG5cbiAgICAvLyBUaGVzZSBhcmUgdGhlIHN0YXRlIHZhcmlhYmxlc1xuICAgIHRoaXMuX2FsbERheXMgPSBbXTtcbiAgICB0aGlzLl9zZWFyY2hBZGRyZXNzID0gbnVsbDtcblxuICAgIGQzLmpzb24ob3B0aW9ucy5vZmZpY2lhbE1lZXRpbmdzSnNvblVybCwgZGF0YSA9PiB7XG4gICAgICB0aGlzLl9tZWV0aW5nU3RvcmUuc2V0T2ZmaWNpYWxzKGRhdGEub2JqZWN0cyk7XG4gICAgICB0aGlzLl9hbGxEYXlzID0gdGhpcy5fbWVldGluZ3NCeURheShcbiAgICAgICAgdGhpcy5fbWVldGluZ1N0b3JlLFxuICAgICAgICB0aGlzLl9zdGFydERhdGUsXG4gICAgICAgIHRoaXMuX2VuZERhdGUsXG4gICAgICAgIHRoaXMuX2Fubm90YXRpb25zXG4gICAgICApO1xuXG4gICAgICB0aGlzLl9yZW5kZXJUaW1lbGluZSh0aGlzLl9hbGxEYXlzKTtcblxuICAgICAgZDMuc2VsZWN0KHRoaXMuX3JlcFNlYXJjaENvbnRhaW5lcilcbiAgICAgICAgLmNhbGwodGhpcy5fc2VhcmNoKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9oYW5kbGVSZXNldCgpIHtcbiAgICBpZiAodGhpcy5fc2VhcmNoQWRkcmVzcyAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5fcmVuZGVyVGltZWxpbmUodGhpcy5fYWxsRGF5cyk7XG4gICAgfVxuICB9XG5cbiAgX3JlbmRlclRpbWVsaW5lKGRheXMpIHtcbiAgICBkMy5zZWxlY3QodGhpcy5fdGltZWxpbmVDb250YWluZXIpXG4gICAgICAuZGF0dW0oZGF5cylcbiAgICAgIC5jYWxsKHRoaXMuX3RpbWVsaW5lKTtcbiAgfVxuXG4gIF9oYW5kbGVBZGRyZXNzKGFkZHJlc3MsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc2VhcmNoQWRkcmVzcyA9IGFkZHJlc3M7XG5cbiAgICAvLyBVc2UgdGhlIEdvb2dsZSBDaXZpYyBJbmZvcm1hdGlvbiBBUEkgdG8gbG9va3VwIHRoZSBVLlMuIFJlcHJlc2VudGF0aXZlXG4gICAgLy8gZm9yIGFuIGFkZHJlc3MuXG4gICAgLy9cbiAgICAvLyBTZWUgaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vY2l2aWMtaW5mb3JtYXRpb24vZG9jcy92Mi9yZXByZXNlbnRhdGl2ZXMvcmVwcmVzZW50YXRpdmVJbmZvQnlBZGRyZXNzXG4gICAgLy8gZm9yIEFQSSBkb2NzLlxuICAgIC8vIEEgZmV3IHF1aWNrIG5vdGVzOlxuICAgIC8vXG4gICAgLy8gV2UganVzdCBuZWVkIHRvIGxvb2sgdXAgcmVwcyBieSB0aGVpciBkaXN0cmljdCwgc28gd2UganVzdCBuZWVkIHRoZVxuICAgIC8vIHBvbGl0aWNhbCBkaXZpc2lvbiBhbmQgbm90IGRhdGEgYWJvdXQgb2ZmaWNlcy4gIFdlIGV4Y2x1ZGUgb2ZmaWNlIGRhdGFcbiAgICAvLyBieSBzcGVjaWZ5aW5nIGBpbmNsdWRlT2ZmaWNlcz1mYWxzZWBcbiAgICAvL1xuICAgIC8vIGBsZXZlbHM9Y291bnRyeWAgYW5kIGByb2xlcz1sZWdpc2xhdG9yTG93ZXJCb2R5YCBzcGVjaWZpZXMgdGhhdCB3ZSBvbmx5XG4gICAgLy8gY2FyZSBhYm91dCB0aGUgaG91c2UuXG4gICAgY29uc3QgdXJsID0gYGh0dHBzOi8vY29udGVudC5nb29nbGVhcGlzLmNvbS9jaXZpY2luZm8vdjIvcmVwcmVzZW50YXRpdmVzP2FkZHJlc3M9JHtlbmNvZGVVUklDb21wb25lbnQoYWRkcmVzcyl9JmluY2x1ZGVPZmZpY2VzPWZhbHNlJmxldmVscz1jb3VudHJ5JnJvbGVzPWxlZ2lzbGF0b3JMb3dlckJvZHkmYWx0PWpzb24ma2V5PSR7dGhpcy5fZ29vZ2xlQXBpS2V5fWA7XG5cbiAgICBkMy5qc29uKHVybCwgZGF0YSA9PiB7XG4gICAgICAvLyBEaXZpc2lvbnMgaXMgYW4gb2JqZWN0IGtleWVkIGJ5IE9DRCBJRC4gV2UgbmVlZCBhIGxpc3Qgb2YgdGhlc2UgSURzLlxuICAgICAgY29uc3QgZGl2aXNpb25zID0gT2JqZWN0LmtleXMoZGF0YS5kaXZpc2lvbnMpO1xuXG4gICAgICAvLyBUaGVyZSBzaG91bGQgYmUgb25lIGFuZCBvbmx5IG9uZSBjb25ncmVzc2lvbmFsIGRpc3RyaWN0IGZvciBhbiBhZGRyZXNzXG4gICAgICBpZiAoZGl2aXNpb25zLmxlbmd0aCAhPSAxKSB7XG4gICAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgICBtc2c6IGRpdmlzaW9uLmxlbmd0aCA9PSAwID8gdGhpcy5fbGFiZWxzLm5vRGlzdHJpY3RGb3VuZCA6IHRoaXMuX2xhYmVscy5tdWx0aXBsZURpc3RyaWN0c0ZvdW5kXG4gICAgICAgIH0sIG51bGwpO1xuICAgICAgfVxuXG4gICAgICAvLyBTdWNjZXNzLiAgVGVsbCB0aGUgZm9ybS5cbiAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgb2NkSWQ6IGRpdmlzaW9uc1swXSxcbiAgICAgICAgbmFtZTogZGF0YS5kaXZpc2lvbnNbZGl2aXNpb25zWzBdXS5uYW1lXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWVldGluZ0lkcyA9IHRoaXMuX21lZXRpbmdTdG9yZS5nZXRNZWV0aW5nc0ZvckRpdmlzaW9uKGRpdmlzaW9uc1swXSkucmVkdWNlKChsb29rdXAsIG1lZXRpbmcpID0+IHtcbiAgICAgICAgbG9va3VwW21lZXRpbmcuaWRdID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGxvb2t1cDtcbiAgICAgIH0sIHt9KTtcbiAgICAgIGNvbnN0IGRheXMgPSB0aGlzLl9tZWV0aW5nc0J5RGF5KFxuICAgICAgICB0aGlzLl9tZWV0aW5nU3RvcmUsXG4gICAgICAgIHRoaXMuX3N0YXJ0RGF0ZSxcbiAgICAgICAgdGhpcy5fZW5kRGF0ZSxcbiAgICAgICAgdGhpcy5fYW5ub3RhdGlvbnMsXG4gICAgICAgIG1lZXRpbmcgPT4gbWVldGluZ0lkc1ttZWV0aW5nLmlkXVxuICAgICAgKTtcbiAgICAgIHRoaXMuX3JlbmRlclRpbWVsaW5lKGRheXMpO1xuICAgIH0pO1xuICB9XG5cbiAgX21lZXRpbmdzQnlEYXkobWVldGluZ1N0b3JlLCBzdGFydERhdGUsIGVuZERhdGUsIGFubm90YXRpb25zLCBmaWx0ZXIpIHtcbiAgICBjb25zdCBkYXlzID0gW107XG4gICAgY29uc3QgZm9ybWF0ID0gZDMudGltZUZvcm1hdChcIiVZLSVtLSVkXCIpO1xuXG4gICAgZDMudGltZURheS5yYW5nZShzdGFydERhdGUsIGVuZERhdGUsIDEpXG4gICAgICAuZm9yRWFjaCgoZGF0ZSwgaSkgPT4ge1xuICAgICAgICBjb25zdCBkYXRlU3RyID0gZm9ybWF0KGRhdGUpO1xuICAgICAgICBjb25zdCBtZWV0aW5ncyA9IG1lZXRpbmdTdG9yZS5nZXRNZWV0aW5nc0ZvckRhdGUoZGF0ZVN0ciwgZmlsdGVyKTtcblxuICAgICAgICBpZiAobWVldGluZ3MubGVuZ3RoID09IDAgJiYgIWFubm90YXRpb25zW2RhdGVTdHJdKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF5cy5wdXNoKHtcbiAgICAgICAgICBkYXk6IGkrMSxcbiAgICAgICAgICBkYXRlOiBkYXRlLFxuICAgICAgICAgIG1lZXRpbmdzOiBtZWV0aW5ncyxcbiAgICAgICAgICBsYWJlbDogYW5ub3RhdGlvbnNbZGF0ZVN0cl0gPyBhbm5vdGF0aW9uc1tkYXRlU3RyXS5sYWJlbCA6IG51bGxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIHJldHVybiBkYXlzLnJldmVyc2UoKTtcbiAgfVxufVxuIiwiaW1wb3J0ICogYXMgZDMgZnJvbSBcImQzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlcFNlYXJjaCgpIHtcbiAgbGV0IGhhbmRsZUFkZHJlc3MgPSBmdW5jdGlvbigpIHt9O1xuICBsZXQgaGFuZGxlUmVzZXQgPSBmdW5jdGlvbigpIHt9O1xuICBsZXQgbWVzc2FnZXMgPSBudWxsO1xuXG4gIGxldCByZWNlaXZlUmVzcG9uc2UgPSBmdW5jdGlvbihlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBtZXNzYWdlcy50ZXh0KGVyci5tc2cpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBgVGhpcyBhZGRyZXNzIGlzIGluICR7ZGF0YS5uYW1lfS5gO1xuICAgIG1lc3NhZ2VzLnRleHQobWVzc2FnZSk7XG4gIH07XG5cbiAgbGV0IGhhbmRsZVN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICAgIGQzLmV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBjb25zdCBmb3JtID0gZDMuc2VsZWN0KGQzLmV2ZW50LnRhcmdldCk7XG4gICAgY29uc3QgYWRkcmVzcyA9IGZvcm0uc2VsZWN0KCcucmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm1fX2FkZHJlc3MtaW5wdXQnKS5ub2RlKCkudmFsdWU7XG5cbiAgICBpZiAoIWFkZHJlc3MpIHtcbiAgICAgIC8vIERvbid0IGFsbG93IGFuIGVtcHR5IGFkZHJlc3NcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBtZXNzYWdlcyA9IGZvcm0uc2VsZWN0KCcucmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm1fX21lc3NhZ2VzJyk7XG4gICAgaGFuZGxlQWRkcmVzcyhhZGRyZXNzLCByZWNlaXZlUmVzcG9uc2UpO1xuICB9O1xuXG4gIGNvbnN0IHNlYXJjaCA9IGZ1bmN0aW9uKHNlbGVjdGlvbikge1xuICAgIHNlbGVjdGlvbi5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3Qgc2VsID0gZDMuc2VsZWN0KHRoaXMpO1xuXG4gICAgICBzZWwuc2VsZWN0QWxsKCcqJykucmVtb3ZlKCk7XG5cbiAgICAgIGNvbnN0IGZvcm0gPSBzZWwuYXBwZW5kKCdmb3JtJylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAncmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm0nKVxuICAgICAgICAgIC5vbignc3VibWl0JywgaGFuZGxlU3VibWl0KTtcblxuICAgICAgZm9ybS5hcHBlbmQoJ2lucHV0JylcbiAgICAgICAgICAuYXR0cigndHlwZScsICd0ZXh0JylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAncmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm1fX2FkZHJlc3MtaW5wdXQnKVxuICAgICAgICAgIC5hdHRyKCdwbGFjZWhvbGRlcicsIFwiRW50ZXIgeW91ciBhZGRyZXNzXCIpO1xuXG4gICAgICBmb3JtLmFwcGVuZCgnYnV0dG9uJylcbiAgICAgICAgICAuYXR0cigndHlwZScsICdzdWJtaXQnKVxuICAgICAgICAgIC50ZXh0KFwiRmluZCB5b3VyIHJlcHJlc2VudGF0aXZlXCIpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3JlcHJlc2VudGF0aXZlLXNlYXJjaC1mb3JtX19idG4gcmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm1fX2J0bi0tc3VibWl0Jyk7XG5cbiAgICAgIGZvcm0uYXBwZW5kKCdidXR0b24nKVxuICAgICAgICAgIC5hdHRyKCd0eXBlJywgJ3Jlc2V0JylcbiAgICAgICAgICAudGV4dChcIlN0YXJ0IG92ZXJcIilcbiAgICAgICAgICAub24oJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgbWVzc2FnZXMudGV4dChcIlwiKTtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnNlbGVjdEFsbCgnKicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgaGFuZGxlUmVzZXQoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdyZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybV9fYnRuIHJlcHJlc2VudGF0aXZlLXNlYXJjaC1mb3JtX19idG4tLXJlc2V0Jyk7XG5cbiAgICAgIGZvcm0uYXBwZW5kKCdkaXYnKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdyZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybV9fbWVzc2FnZXMnKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNlYXJjaC5oYW5kbGVBZGRyZXNzID0gZnVuY3Rpb24odmFsKSB7XG4gICAgaWYgKCF2YWwpIHsgcmV0dXJuIGhhbmRsZUFkZHJlc3M7IH1cblxuICAgIGhhbmRsZUFkZHJlc3MgPSB2YWw7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZWFyY2guaGFuZGxlUmVzZXQgPSBmdW5jdGlvbih2YWwpIHtcbiAgICBpZiAoIXZhbCkgeyByZXR1cm4gaGFuZGxlUmVzZXQ7IH1cblxuICAgIGhhbmRsZVJlc2V0ID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmV0dXJuIHNlYXJjaDtcbn1cbiIsImltcG9ydCAqIGFzIGQzIGZyb20gXCJkM1wiO1xuXG5mdW5jdGlvbiBvY2RJZFRvRGlzdHJpY3Qob2NkSWQpIHtcbiAgY29uc3QgYml0cyA9IG9jZElkLnNwbGl0KCc6Jyk7XG4gIGNvbnN0IHN0YXRlID0gYml0c1tiaXRzLmxlbmd0aCAtIDJdLnNsaWNlKDAsIDIpLnRvVXBwZXJDYXNlKCk7XG4gIGNvbnN0IGRpc3RyaWN0ID0gYml0c1tiaXRzLmxlbmd0aCAtIDFdO1xuICByZXR1cm4gc3RhdGUgKyBcIi1cIiArIGRpc3RyaWN0O1xufVxuXG5mdW5jdGlvbiBvZmZpY2lhbERpc3RyaWN0KG9mZmljaWFsKSB7XG4gIHJldHVybiBvY2RJZFRvRGlzdHJpY3Qob2ZmaWNpYWwub2ZmaWNlLmRpdmlzaW9uLm9jZF9pZCk7XG59XG5cbmZ1bmN0aW9uIG1lZXRpbmdzQnlPZmZpY2lhbChtZWV0aW5ncykge1xuICBjb25zdCBieU9mZmljaWFsID0gbWVldGluZ3MucmVkdWNlKChsb29rdXAsIG1lZXRpbmcpID0+IHtcbiAgICBpZiAoIWxvb2t1cFttZWV0aW5nLm9mZmljaWFsLmlkXSkge1xuICAgICAgbG9va3VwW21lZXRpbmcub2ZmaWNpYWwuaWRdID0ge1xuICAgICAgICBvZmZpY2lhbDogbWVldGluZy5vZmZpY2lhbCxcbiAgICAgICAgbWVldGluZ3M6IFtdXG4gICAgICB9O1xuICAgIH1cbiAgICBsb29rdXBbbWVldGluZy5vZmZpY2lhbC5pZF0ubWVldGluZ3MucHVzaChtZWV0aW5nKTtcbiAgICByZXR1cm4gbG9va3VwO1xuICB9LCB7fSk7XG5cbiAgcmV0dXJuIGQzLnZhbHVlcyhieU9mZmljaWFsKTtcbn1cblxuZnVuY3Rpb24gZ2V0UGFydHlMYWJlbChwYXJ0eSkge1xuICBpZiAocGFydHkgPT0gXCJSZXB1YmxpY2FuXCIpIHtcbiAgICByZXR1cm4gXCJSXCI7XG4gIH1cbiAgZWxzZSBpZiAocGFydHkgPT0gXCJEZW1vY3JhdGljXCIpIHtcbiAgICByZXR1cm4gXCJEXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVuZGVyT2ZmaWNpYWwoc2VsKSB7XG4gIHNlbC5lYWNoKGZ1bmN0aW9uKGQpIHtcbiAgICBjb25zdCBlbCA9IGQzLnNlbGVjdCh0aGlzKTtcblxuICAgIGNvbnN0IHBhcnR5TGFiZWwgPSBnZXRQYXJ0eUxhYmVsKGQub2ZmaWNpYWwucGFydHkpO1xuICAgIGxldCBvZmZpY2lhbENsYXNzID0gXCJ0aW1lbGluZV9fbWVldGluZ19fb2ZmaWNpYWxcIjtcbiAgICBpZiAocGFydHlMYWJlbCkge1xuICAgICAgb2ZmaWNpYWxDbGFzcyArPSBcIiB0aW1lbGluZV9fbWVldGluZ19fb2ZmaWNpYWwtLVwiICsgcGFydHlMYWJlbC50b0xvd2VyQ2FzZSgpO1xuICAgIH1cblxuICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsIG9mZmljaWFsQ2xhc3MpXG4gICAgICAgIC50ZXh0KGQub2ZmaWNpYWwubmFtZSk7XG5cbiAgICBpZiAocGFydHlMYWJlbCkge1xuICAgICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX21lZXRpbmdfX3BhcnR5IHRpbWVsaW5lX19tZWV0aW5nX19wYXJ0eS0tJyArIHBhcnR5TGFiZWwudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICAudGV4dChcIiAoXCIgKyBwYXJ0eUxhYmVsICsgXCIpXCIpO1xuICAgIH1cblxuICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fbWVldGluZ19fZGlzdHJpY3QnKVxuICAgICAgICAudGV4dChcIiAoXCIgKyBvZmZpY2lhbERpc3RyaWN0KGQub2ZmaWNpYWwpICsgXCIpXCIpO1xuXG4gICAgaWYgKGQubWVldGluZ3MubGVuZ3RoID09IDEpIHtcbiAgICAgIGlmIChkLm1lZXRpbmdzWzBdLm1lZXRpbmdfdHlwZSA9PSBcInRlbGVwaG9uZVwiKSB7XG4gICAgICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX21lZXRpbmdfX3R5cGUgdGltZWxpbmVfX21lZXRpbmdfX3R5cGUtLXRlbGVwaG9uZScpXG4gICAgICAgICAgICAudGV4dChcIiBcXHUyNjBFXCIpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoZC5tZWV0aW5nc1swXS5tZWV0aW5nX3R5cGUgPT0gXCJmYWNlYm9va1wiKSB7XG4gICAgICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX21lZXRpbmdfX3R5cGUgdGltZWxpbmVfX21lZXRpbmdfX3R5cGUtLWZhY2Vib29rJylcbiAgICAgICAgICAgIC50ZXh0KFwiIGZcIik7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChkLm1lZXRpbmdzWzBdLm1lZXRpbmdfdHlwZSA9PSBcInJhZGlvXCIpIHtcbiAgICAgICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fbWVldGluZ19fdHlwZSB0aW1lbGluZV9fbWVldGluZ19fdHlwZS0tcmFkaW8nKVxuICAgICAgICAgICAgLnRleHQoXCIgXFx1MUY0RkJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGQubWVldGluZ3MubGVuZ3RoID4gMSkge1xuICAgICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX21lZXRpbmdfX2NvdW50JylcbiAgICAgICAgICAudGV4dChcIiB4XCIgKyBkLm1lZXRpbmdzLmxlbmd0aCk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyRGF5KHNlbCwgZGF0ZUZvcm1hdCkge1xuICBzZWwuYXBwZW5kKCdoMicpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lX19kYXlfX251bWJlcicpXG4gICAgLnRleHQoZCA9PiBkLmRheSk7XG5cbiAgc2VsLmFwcGVuZCgnZGl2JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX2RheV9fZGF0ZScpXG4gICAgLnRleHQoZCA9PiBkYXRlRm9ybWF0KGQuZGF0ZSkpO1xuXG4gIHNlbC5hcHBlbmQoJ2RpdicpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lX19kYXlfX2xhYmVsJylcbiAgICAudGV4dChkID0+IGQubGFiZWwpO1xuXG4gIHNlbC5zZWxlY3RBbGwoJy50aW1lbGluZV9fbWVldGluZycpXG4gICAgLmRhdGEoZCA9PiBtZWV0aW5nc0J5T2ZmaWNpYWwoZC5tZWV0aW5ncykpXG4gICAgLmVudGVyKCkuYXBwZW5kKCdkaXYnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lX19tZWV0aW5nJylcbiAgICAgIC5jYWxsKHJlbmRlck9mZmljaWFsKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWVldGluZ1RpbWVsaW5lKCkge1xuICBsZXQgZGF0ZUZvcm1hdCA9IGQzLnRpbWVGb3JtYXQoXCIlQiAlZCwgJVlcIik7XG5cbiAgZnVuY3Rpb24gdGltZWxpbmUoc2VsZWN0aW9uKSB7XG4gICAgc2VsZWN0aW9uLmVhY2goZnVuY3Rpb24oZGF5cykge1xuICAgICAgY29uc3QgY29udGFpbmVyID0gZDMuc2VsZWN0KHRoaXMpO1xuICAgICAgY29udGFpbmVyLnNlbGVjdEFsbCgnKicpLnJlbW92ZSgpO1xuXG4gICAgICBjb25zdCB0aW1lbGluZSA9IGNvbnRhaW5lci5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lJyk7XG5cbiAgICAgIHRpbWVsaW5lLnNlbGVjdEFsbCgnLnRpbWVsaW5lX19kYXknKVxuICAgICAgICAuZGF0YShkYXlzKVxuICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lX19kYXknKVxuICAgICAgICAgIC5jYWxsKHJlbmRlckRheSwgZGF0ZUZvcm1hdCk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdGltZWxpbmU7XG59XG4iXX0=

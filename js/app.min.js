(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.TownHalls = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var MeetingStore = function () {
  function MeetingStore() {
    _classCallCheck(this, MeetingStore);

    this._meetings = [];
    this._meetingsByDate = {};
    this._meetingsByOfficial = {};
    this._meetingsByDivision = {};
    this._officials = [];
    this._officialsByDivision = {};
  }

  _createClass(MeetingStore, [{
    key: "setOfficials",
    value: function setOfficials(officials) {
      this._officials = officials;
      this._setMeetingsFromOfficials(this._officials);
    }
  }, {
    key: "getOfficials",
    value: function getOfficials() {
      return this._officials;
    }
  }, {
    key: "_setMeetingsFromOfficials",
    value: function _setMeetingsFromOfficials(officials) {
      var _this = this;

      var sort = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

      this._meetings = [];
      this._meetingsByDate = {};
      this._officialsByDivision = {};

      officials.forEach(function (official) {
        _this._officialsByDivision[official.office.division.ocd_id] = official;

        official.meetings.forEach(function (meeting) {
          meeting.official = official;
          _this.addMeeting(meeting);
        });
      });

      if (sort) {
        this._sortMeetingsByDate();
      }

      return this;
    }
  }, {
    key: "_sortMeetingsByDate",
    value: function _sortMeetingsByDate() {
      this._meetings.sort(function (a, b) {
        if (a.date > b.date) {
          return -1;
        }

        if (a.date < b.date) {
          return 1;
        }

        return 0;
      });
    }
  }, {
    key: "addMeeting",
    value: function addMeeting(meeting) {
      this._meetings.push(meeting);

      if (!this._meetingsByDate[meeting.date]) {
        this._meetingsByDate[meeting.date] = [];
      }
      this._meetingsByDate[meeting.date].push(meeting);

      if (!this._meetingsByOfficial[meeting.official.id]) {
        this._meetingsByOfficial[meeting.official.id] = [];
      }
      this._meetingsByOfficial[meeting.official.id].push(meeting);

      var ocdId = meeting.official.office.division.ocd_id;
      if (!this._meetingsByDivision[ocdId]) {
        this._meetingsByDivision[ocdId] = [];
      }
      this._meetingsByDivision[ocdId].push(meeting);

      return this;
    }
  }, {
    key: "getMeetings",
    value: function getMeetings() {
      return this._meetings;
    }
  }, {
    key: "getMeetingsForDate",
    value: function getMeetingsForDate(date, filter) {
      var meetings = this._meetingsByDate[date];
      if (!meetings) {
        return [];
      }

      if (filter) {
        return meetings.filter(filter);
      }

      return meetings;
    }
  }, {
    key: "getMeetingsForOfficial",
    value: function getMeetingsForOfficial(officialId) {
      return this._meetingsByOfficial[officialId];
    }
  }, {
    key: "getMeetingsForDivision",
    value: function getMeetingsForDivision(ocdId) {
      var meetings = this._meetingsByDivision[ocdId];
      if (!meetings) {
        return [];
      }

      return meetings;
    }
  }, {
    key: "getOfficialForDivision",
    value: function getOfficialForDivision(ocdId) {
      return this._officialsByDivision[ocdId];
    }
  }, {
    key: "getAvgMeetings",
    value: function getAvgMeetings() {
      return Math.round(this._meetings.length / this._officials.length);
    }
  }]);

  return MeetingStore;
}();

exports.default = MeetingStore;

},{}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.App = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _d = require('d3');

var d3 = _interopRequireWildcard(_d);

var _MeetingStore = require('./MeetingStore');

var _MeetingStore2 = _interopRequireDefault(_MeetingStore);

var _timeline = require('./timeline');

var _timeline2 = _interopRequireDefault(_timeline);

var _repsearch = require('./repsearch');

var _repsearch2 = _interopRequireDefault(_repsearch);

var _repcontext = require('./repcontext');

var _repcontext2 = _interopRequireDefault(_repcontext);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var DEFAULT_LABELS = {
  noDistrictFound: "Could not find a district matching this address",
  multipleDistrictsFound: "Found more than one districts matching this address",
  districtName: function districtName(_districtName) {
    return 'This address is in ' + _districtName + '.';
  },
  officialName: function officialName(_officialName) {
    return 'The representative for this district is ' + _officialName + '.';
  },
  avgMeetings: function avgMeetings(numMeetings) {
    var s = numMeetings == 1 ? '' : 's';
    return 'This representative has held ' + numMeetings + ' meeting' + s + ', the average for Appalachian representatives.';
  },
  aboveAvgMeetings: function aboveAvgMeetings(numMeetings, avgMeetings) {
    var s = numMeetings == 1 ? '' : 's';
    return 'This representative has held ' + numMeetings + ' meeting' + s + ', more than the average for Appalachian representatives.';
  },
  belowAvgMeetings: function belowAvgMeetings(numMeetings, avgMeetings) {
    var s = numMeetings == 1 ? '' : 's';
    var numMeetingsWord = numMeetings == 0 ? 'no' : numMeetings;
    return 'This representative has held ' + numMeetingsWord + ' meeting' + s + ', below the average of ' + avgMeetings + ' for Appalachian representatives.';
  }
};

var App = exports.App = function () {
  function App(options) {
    var _this = this;

    _classCallCheck(this, App);

    this._timelineContainer = options.timelineContainer;
    this._repSearchContainer = options.repSearchContainer;
    this._repContextContainer = options.repContextContainer;
    this._googleApiKey = options.googleApiKey;
    this._labels = options.labels || DEFAULT_LABELS;
    this._meetingStore = new _MeetingStore2.default();
    this._startDate = options.startDate || new Date(2017, 0, 20);
    this._endDate = options.endDate || new Date();
    this._annotations = options.annotations || {
      "2017-01-20": {
        label: "Inauguration day"
      },
      "2017-02-20": {
        label: "District work period begins"
      },
      "2017-02-24": {
        label: "District work period ends"
      },
      "2017-04-10": {
        label: "District work period begins"
      },
      "2017-04-21": {
        label: "District work period ends"
      }
    };

    // Explicitely bind this method to the instance so that we can access
    // `this` when the method is used as a callback
    this._handleAddress = this._handleAddress.bind(this);
    this._handleReset = this._handleReset.bind(this);

    // Construct some d3 components
    this._timeline = (0, _timeline2.default)();
    this._search = (0, _repsearch2.default)().handleAddress(this._handleAddress).handleReset(this._handleReset);
    this._context = (0, _repcontext2.default)().labels(this._labels);

    // These are the state variables
    this._allDays = [];
    this._searchAddress = null;

    d3.json(options.officialMeetingsJsonUrl, function (data) {
      _this._meetingStore.setOfficials(data.objects);
      _this._allDays = _this._meetingsByDay(_this._meetingStore, _this._startDate, _this._endDate, _this._annotations);

      _this._renderTimeline(_this._allDays);

      d3.select(_this._repSearchContainer).call(_this._search);
    });
  }

  _createClass(App, [{
    key: '_handleReset',
    value: function _handleReset() {
      if (this._searchAddress !== null) {
        this._renderTimeline(this._allDays);
        d3.select(this._repContextContainer).datum(null).call(this._context);
      }
    }
  }, {
    key: '_renderTimeline',
    value: function _renderTimeline(days) {
      d3.select(this._timelineContainer).datum(days).call(this._timeline);
    }
  }, {
    key: '_handleAddress',
    value: function _handleAddress(address, callback) {
      var _this2 = this;

      this._searchAddress = address;

      // Use the Google Civic Information API to lookup the U.S. Representative
      // for an address.
      //
      // See https://developers.google.com/civic-information/docs/v2/representatives/representativeInfoByAddress
      // for API docs.
      // A few quick notes:
      //
      // We just need to look up reps by their district, so we just need the
      // political division and not data about offices.  We exclude office data
      // by specifying `includeOffices=false`
      //
      // `levels=country` and `roles=legislatorLowerBody` specifies that we only
      // care about the house.
      var url = 'https://content.googleapis.com/civicinfo/v2/representatives?address=' + encodeURIComponent(address) + '&includeOffices=false&levels=country&roles=legislatorLowerBody&alt=json&key=' + this._googleApiKey;

      d3.json(url, function (data) {
        if (!data) {
          callback({
            msg: _this2._labels.noDistrictFound
          }, null);
          return;
        }
        // Divisions is an object keyed by OCD ID. We need a list of these IDs.
        var divisions = Object.keys(data.divisions);

        // There should be one and only one congressional district for an address
        if (divisions.length != 1) {
          callback({
            msg: division.length == 0 ? _this2._labels.noDistrictFound : _this2._labels.multipleDistrictsFound
          }, null);
        }

        // Success
        var ocdId = divisions[0];
        var districtName = data.divisions[ocdId].name;

        // Tell the form
        callback(null, {});

        var meetingsForDivision = _this2._meetingStore.getMeetingsForDivision(divisions[0]);
        var meetingIds = meetingsForDivision.reduce(function (lookup, meeting) {
          lookup[meeting.id] = true;
          return lookup;
        }, {});

        d3.select(_this2._repContextContainer).datum({
          official: _this2._meetingStore.getOfficialForDivision(ocdId),
          numMeetings: meetingsForDivision.length,
          avgMeetings: _this2._meetingStore.getAvgMeetings(),
          districtName: districtName
        }).call(_this2._context);

        var days = _this2._meetingsByDay(_this2._meetingStore, _this2._startDate, _this2._endDate, _this2._annotations, function (meeting) {
          return meetingIds[meeting.id];
        });
        _this2._renderTimeline(days);
      });
    }
  }, {
    key: '_meetingsByDay',
    value: function _meetingsByDay(meetingStore, startDate, endDate, annotations, filter) {
      var days = [];
      var format = d3.timeFormat("%Y-%m-%d");

      d3.timeDay.range(startDate, endDate, 1).forEach(function (date, i) {
        var dateStr = format(date);
        var meetings = meetingStore.getMeetingsForDate(dateStr, filter);

        if (meetings.length == 0 && !annotations[dateStr]) {
          return;
        }

        days.push({
          day: i + 1,
          date: date,
          meetings: meetings,
          label: annotations[dateStr] ? annotations[dateStr].label : null
        });
      });

      return days.reverse();
    }
  }]);

  return App;
}();

},{"./MeetingStore":1,"./repcontext":3,"./repsearch":4,"./timeline":5,"d3":"d3"}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = repContext;

var _d = require('d3');

var d3 = _interopRequireWildcard(_d);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function repContext() {
  var labels = {};

  var context = function context(selection) {
    selection.each(function (data) {
      var sel = d3.select(this);

      sel.selectAll('*').remove();

      if (!data) {
        return;
      }

      var el = sel.append('div').attr('class', 'representative-context');

      if (data.districtName) {
        el.append('span').text(labels.districtName(data.districtName));
      }

      if (data.official) {
        el.append('span').text(labels.officialName(data.official.name));
      }

      if (data.numMeetings == data.avgMeetings) {
        el.append('span').text(labels.avgMeetings(data.numMeetings));
      } else if (data.numMeetings > data.avgMeetings) {
        el.append('span').text(labels.aboveAvgMeetings(data.numMeetings, data.avgMeetings));
      } else {
        el.append('span').text(labels.belowAvgMeetings(data.numMeetings, data.avgMeetings));
      }
    });
  };

  context.labels = function (val) {
    if (!val) {
      return labels;
    }

    labels = val;
    return this;
  };

  return context;
}

},{"d3":"d3"}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = repSearch;

var _d = require("d3");

var d3 = _interopRequireWildcard(_d);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function repSearch() {
  var handleAddress = function handleAddress() {};
  var handleReset = function handleReset() {};
  var messages = null;

  var receiveResponse = function receiveResponse(err, data) {
    if (err) {
      messages.text(err.msg);
      return;
    }

    messages.text("");
  };

  var handleSubmit = function handleSubmit() {
    d3.event.preventDefault();

    var form = d3.select(d3.event.target);
    var address = form.select('.representative-search-form__address-input').node().value;

    if (!address) {
      // Don't allow an empty address
      return false;
    }

    messages = form.select('.representative-search-form__messages');
    handleAddress(address, receiveResponse);
  };

  var search = function search(selection) {
    selection.each(function () {
      var sel = d3.select(this);

      sel.selectAll('*').remove();

      var form = sel.append('form').attr('class', 'representative-search-form').on('submit', handleSubmit);

      form.append('input').attr('type', 'text').attr('class', 'representative-search-form__address-input').attr('placeholder', "Enter your address");

      form.append('button').attr('type', 'submit').text("Find your representative").attr('class', 'representative-search-form__btn representative-search-form__btn--submit');

      form.append('button').attr('type', 'reset').text("Start over").on('click', function () {
        messages.text("");
        messages.selectAll('*').remove();
        handleReset();
      }).attr('class', 'representative-search-form__btn representative-search-form__btn--reset');

      form.append('div').attr('class', 'representative-search-form__messages');
    });
  };

  search.handleAddress = function (val) {
    if (!val) {
      return handleAddress;
    }

    handleAddress = val;
    return this;
  };

  search.handleReset = function (val) {
    if (!val) {
      return handleReset;
    }

    handleReset = val;
    return this;
  };

  return search;
}

},{"d3":"d3"}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = meetingTimeline;

var _d = require("d3");

var d3 = _interopRequireWildcard(_d);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function ocdIdToDistrict(ocdId) {
  var bits = ocdId.split(':');
  var state = bits[bits.length - 2].slice(0, 2).toUpperCase();
  var district = bits[bits.length - 1];
  return state + "-" + district;
}

function officialDistrict(official) {
  return ocdIdToDistrict(official.office.division.ocd_id);
}

function meetingsByOfficial(meetings) {
  var byOfficial = meetings.reduce(function (lookup, meeting) {
    if (!lookup[meeting.official.id]) {
      lookup[meeting.official.id] = {
        official: meeting.official,
        meetings: []
      };
    }
    lookup[meeting.official.id].meetings.push(meeting);
    return lookup;
  }, {});

  return d3.values(byOfficial);
}

function getPartyLabel(party) {
  if (party == "Republican") {
    return "R";
  } else if (party == "Democratic") {
    return "D";
  }
}

function renderOfficial(sel) {
  sel.each(function (d) {
    var el = d3.select(this);

    var partyLabel = getPartyLabel(d.official.party);
    var officialClass = "timeline__meeting__official";
    if (partyLabel) {
      officialClass += " timeline__meeting__official--" + partyLabel.toLowerCase();
    }

    el.append('span').attr('class', officialClass).text(d.official.name);

    if (partyLabel) {
      el.append('span').attr('class', 'timeline__meeting__party timeline__meeting__party--' + partyLabel.toLowerCase()).text(" (" + partyLabel + ")");
    }

    el.append('span').attr('class', 'timeline__meeting__district').text(" (" + officialDistrict(d.official) + ")");

    if (d.meetings.length == 1) {
      if (d.meetings[0].meeting_type == "telephone") {
        el.append('span').attr('class', 'timeline__meeting__type timeline__meeting__type--telephone').text(" \u260E");
      } else if (d.meetings[0].meeting_type == "facebook") {
        el.append('span').attr('class', 'timeline__meeting__type timeline__meeting__type--facebook').text(" f");
      } else if (d.meetings[0].meeting_type == "radio") {
        el.append('span').attr('class', 'timeline__meeting__type timeline__meeting__type--radio').text(" \u1F4FB");
      }
    }

    if (d.meetings.length > 1) {
      el.append('span').attr('class', 'timeline__meeting__count').text(" x" + d.meetings.length);
    }
  });
}

function renderDay(sel, dateFormat) {
  sel.append('h2').attr('class', 'timeline__day__number').text(function (d) {
    return d.day;
  });

  sel.append('div').attr('class', 'timeline__day__date').text(function (d) {
    return dateFormat(d.date);
  });

  sel.append('div').attr('class', 'timeline__day__label').text(function (d) {
    return d.label;
  });

  sel.selectAll('.timeline__meeting').data(function (d) {
    return meetingsByOfficial(d.meetings);
  }).enter().append('div').attr('class', 'timeline__meeting').call(renderOfficial);
}

function meetingTimeline() {
  var dateFormat = d3.timeFormat("%B %d, %Y");

  function timeline(selection) {
    selection.each(function (days) {
      var container = d3.select(this);
      container.selectAll('*').remove();

      var timeline = container.append('div').attr('class', 'timeline');

      timeline.selectAll('.timeline__day').data(days).enter().append('div').attr('class', 'timeline__day').call(renderDay, dateFormat);
    });
  }

  return timeline;
}

},{"d3":"d3"}]},{},[2])(2)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwianMvc3JjL01lZXRpbmdTdG9yZS5qcyIsImpzL3NyYy9hcHAuanMiLCJqcy9zcmMvcmVwY29udGV4dC5qcyIsImpzL3NyYy9yZXBzZWFyY2guanMiLCJqcy9zcmMvdGltZWxpbmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7O0lDQU0sWTtBQUNKLDBCQUFjO0FBQUE7O0FBQ1osU0FBSyxTQUFMLEdBQWlCLEVBQWpCO0FBQ0EsU0FBSyxlQUFMLEdBQXVCLEVBQXZCO0FBQ0EsU0FBSyxtQkFBTCxHQUEyQixFQUEzQjtBQUNBLFNBQUssbUJBQUwsR0FBMkIsRUFBM0I7QUFDQSxTQUFLLFVBQUwsR0FBa0IsRUFBbEI7QUFDQSxTQUFLLG9CQUFMLEdBQTRCLEVBQTVCO0FBQ0Q7Ozs7aUNBRVksUyxFQUFXO0FBQ3RCLFdBQUssVUFBTCxHQUFrQixTQUFsQjtBQUNBLFdBQUsseUJBQUwsQ0FBK0IsS0FBSyxVQUFwQztBQUNEOzs7bUNBRWM7QUFDYixhQUFPLEtBQUssVUFBWjtBQUNEOzs7OENBRXlCLFMsRUFBd0I7QUFBQTs7QUFBQSxVQUFiLElBQWEsdUVBQU4sSUFBTTs7QUFDaEQsV0FBSyxTQUFMLEdBQWlCLEVBQWpCO0FBQ0EsV0FBSyxlQUFMLEdBQXVCLEVBQXZCO0FBQ0EsV0FBSyxvQkFBTCxHQUE0QixFQUE1Qjs7QUFFQSxnQkFBVSxPQUFWLENBQWtCLG9CQUFZO0FBQzVCLGNBQUssb0JBQUwsQ0FBMEIsU0FBUyxNQUFULENBQWdCLFFBQWhCLENBQXlCLE1BQW5ELElBQTZELFFBQTdEOztBQUVBLGlCQUFTLFFBQVQsQ0FBa0IsT0FBbEIsQ0FBMEIsbUJBQVc7QUFDbkMsa0JBQVEsUUFBUixHQUFtQixRQUFuQjtBQUNBLGdCQUFLLFVBQUwsQ0FBZ0IsT0FBaEI7QUFDRCxTQUhEO0FBSUQsT0FQRDs7QUFTQSxVQUFJ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QUZSOztBQUlBLE1BQUksU0FBSixDQUFjLG9CQUFkLEVBQ0csSUFESCxDQUNRO0FBQUEsV0FBSyxtQkFBbUIsRUFBRSxRQUFyQixDQUFMO0FBQUEsR0FEUixFQUVHLEtBRkgsR0FFVyxNQUZYLENBRWtCLEtBRmxCLEVBR0ssSUFITCxDQUdVLE9BSFYsRUFHbUIsbUJBSG5CLEVBSUssSUFKTCxDQUlVLGNBSlY7QUFLRDs7QUFFYyxTQUFTLGVBQVQsR0FBMkI7QUFDeEMsTUFBSSxhQUFhLEdBQUcsVUFBSCxDQUFjLFdBQWQsQ0FBakI7O0FBRUEsV0FBUyxRQUFULENBQWtCLFNBQWxCLEVBQTZCO0FBQzNCLGNBQVUsSUFBVixDQUFlLFVBQVMsSUFBVCxFQUFlO0FBQzVCLFVBQU0sWUFBWSxHQUFHLE1BQUgsQ0FBVSxJQUFWLENBQWxCO0FBQ0EsZ0JBQVUsU0FBVixDQUFvQixHQUFwQixFQUF5QixNQUF6Qjs7QUFFQSxVQUFNLFdBQVcsVUFBVSxNQUFWLENBQWlCLEtBQWpCLEVBQ1osSUFEWSxDQUNQLE9BRE8sRUFDRSxVQURGLENBQWpCOztBQUdBLGVBQVMsU0FBVCxDQUFtQixnQkFBbkIsRUFDRyxJQURILENBQ1EsSUFEUixFQUVHLEtBRkgsR0FFVyxNQUZYLENBRWtCLEtBRmxCLEVBR0ssSUFITCxDQUdVLE9BSFYsRUFHbUIsZUFIbkIsRUFJSyxJQUpMLENBSVUsU0FKVixFQUlxQixVQUpyQjtBQUtELEtBWkQ7QUFhRDs7QUFFRCxTQUFPLFFBQVA7QUFDRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjbGFzcyBNZWV0aW5nU3RvcmUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9tZWV0aW5ncyA9IFtdO1xuICAgIHRoaXMuX21lZXRpbmdzQnlEYXRlID0ge307XG4gICAgdGhpcy5fbWVldGluZ3NCeU9mZmljaWFsID0ge307XG4gICAgdGhpcy5fbWVldGluZ3NCeURpdmlzaW9uID0ge307XG4gICAgdGhpcy5fb2ZmaWNpYWxzID0gW107XG4gICAgdGhpcy5fb2ZmaWNpYWxzQnlEaXZpc2lvbiA9IHt9O1xuICB9XG5cbiAgc2V0T2ZmaWNpYWxzKG9mZmljaWFscykge1xuICAgIHRoaXMuX29mZmljaWFscyA9IG9mZmljaWFscztcbiAgICB0aGlzLl9zZXRNZWV0aW5nc0Zyb21PZmZpY2lhbHModGhpcy5fb2ZmaWNpYWxzKTtcbiAgfVxuXG4gIGdldE9mZmljaWFscygpIHtcbiAgICByZXR1cm4gdGhpcy5fb2ZmaWNpYWxzO1xuICB9XG5cbiAgX3NldE1lZXRpbmdzRnJvbU9mZmljaWFscyhvZmZpY2lhbHMsIHNvcnQgPSB0cnVlKSB7XG4gICAgdGhpcy5fbWVldGluZ3MgPSBbXTtcbiAgICB0aGlzLl9tZWV0aW5nc0J5RGF0ZSA9IHt9O1xuICAgIHRoaXMuX29mZmljaWFsc0J5RGl2aXNpb24gPSB7fTtcblxuICAgIG9mZmljaWFscy5mb3JFYWNoKG9mZmljaWFsID0+IHtcbiAgICAgIHRoaXMuX29mZmljaWFsc0J5RGl2aXNpb25bb2ZmaWNpYWwub2ZmaWNlLmRpdmlzaW9uLm9jZF9pZF0gPSBvZmZpY2lhbDtcblxuICAgICAgb2ZmaWNpYWwubWVldGluZ3MuZm9yRWFjaChtZWV0aW5nID0+IHtcbiAgICAgICAgbWVldGluZy5vZmZpY2lhbCA9IG9mZmljaWFsO1xuICAgICAgICB0aGlzLmFkZE1lZXRpbmcobWVldGluZyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmIChzb3J0KSB7XG4gICAgICB0aGlzLl9zb3J0TWVldGluZ3NCeURhdGUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIF9zb3J0TWVldGluZ3NCeURhdGUoKSB7XG4gICAgdGhpcy5fbWVldGluZ3Muc29ydCgoYSwgYikgPT4ge1xuICAgICAgaWYgKGEuZGF0ZSA+IGIuZGF0ZSkge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG5cbiAgICAgIGlmIChhLmRhdGUgPCBiLmRhdGUpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAwO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkTWVldGluZyhtZWV0aW5nKSB7XG4gICAgdGhpcy5fbWVldGluZ3MucHVzaChtZWV0aW5nKTtcblxuICAgIGlmICghdGhpcy5fbWVldGluZ3NCeURhdGVbbWVldGluZy5kYXRlXSkge1xuICAgICAgdGhpcy5fbWVldGluZ3NCeURhdGVbbWVldGluZy5kYXRlXSA9IFtdO1xuICAgIH1cbiAgICB0aGlzLl9tZWV0aW5nc0J5RGF0ZVttZWV0aW5nLmRhdGVdLnB1c2gobWVldGluZyk7XG5cbiAgICBpZiAoIXRoaXMuX21lZXRpbmdzQnlPZmZpY2lhbFttZWV0aW5nLm9mZmljaWFsLmlkXSkge1xuICAgICAgdGhpcy5fbWVldGluZ3NCeU9mZmljaWFsW21lZXRpbmcub2ZmaWNpYWwuaWRdID0gW107XG4gICAgfVxuICAgIHRoaXMuX21lZXRpbmdzQnlPZmZpY2lhbFttZWV0aW5nLm9mZmljaWFsLmlkXS5wdXNoKG1lZXRpbmcpO1xuXG4gICAgY29uc3Qgb2NkSWQgPSBtZWV0aW5nLm9mZmljaWFsLm9mZmljZS5kaXZpc2lvbi5vY2RfaWQ7XG4gICAgaWYgKCF0aGlzLl9tZWV0aW5nc0J5RGl2aXNpb25bb2NkSWRdKSB7XG4gICAgICB0aGlzLl9tZWV0aW5nc0J5RGl2aXNpb25bb2NkSWRdID0gW107XG4gICAgfVxuICAgIHRoaXMuX21lZXRpbmdzQnlEaXZpc2lvbltvY2RJZF0ucHVzaChtZWV0aW5nKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZ2V0TWVldGluZ3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21lZXRpbmdzO1xuICB9XG5cbiAgZ2V0TWVldGluZ3NGb3JEYXRlKGRhdGUsIGZpbHRlcikge1xuICAgIGNvbnN0IG1lZXRpbmdzID0gdGhpcy5fbWVldGluZ3NCeURhdGVbZGF0ZV07XG4gICAgaWYgKCFtZWV0aW5ncykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXIpIHtcbiAgICAgIHJldHVybiBtZWV0aW5ncy5maWx0ZXIoZmlsdGVyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbWVldGluZ3M7XG4gIH1cblxuICBnZXRNZWV0aW5nc0Zvck9mZmljaWFsKG9mZmljaWFsSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fbWVldGluZ3NCeU9mZmljaWFsW29mZmljaWFsSWRdO1xuICB9XG5cbiAgZ2V0TWVldGluZ3NGb3JEaXZpc2lvbihvY2RJZCkge1xuICAgIGNvbnN0IG1lZXRpbmdzID0gdGhpcy5fbWVldGluZ3NCeURpdmlzaW9uW29jZElkXTtcbiAgICBpZiAoIW1lZXRpbmdzKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcmV0dXJuIG1lZXRpbmdzO1xuICB9XG5cbiAgZ2V0T2ZmaWNpYWxGb3JEaXZpc2lvbihvY2RJZCkge1xuICAgIHJldHVybiB0aGlzLl9vZmZpY2lhbHNCeURpdmlzaW9uW29jZElkXTtcbiAgfVxuXG4gIGdldEF2Z01lZXRpbmdzKCkge1xuICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuX21lZXRpbmdzLmxlbmd0aCAvIHRoaXMuX29mZmljaWFscy5sZW5ndGgpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IE1lZXRpbmdTdG9yZTtcbiIsImltcG9ydCAqIGFzIGQzIGZyb20gXCJkM1wiO1xuXG5pbXBvcnQgTWVldGluZ1N0b3JlIGZyb20gJy4vTWVldGluZ1N0b3JlJztcbmltcG9ydCBtZWV0aW5nVGltZWxpbmUgZnJvbSAnLi90aW1lbGluZSc7XG5pbXBvcnQgcmVwU2VhcmNoIGZyb20gJy4vcmVwc2VhcmNoJztcbmltcG9ydCByZXBDb250ZXh0IGZyb20gJy4vcmVwY29udGV4dCc7XG5cbmNvbnN0IERFRkFVTFRfTEFCRUxTID0ge1xuICBub0Rpc3RyaWN0Rm91bmQ6IFwiQ291bGQgbm90IGZpbmQgYSBkaXN0cmljdCBtYXRjaGluZyB0aGlzIGFkZHJlc3NcIixcbiAgbXVsdGlwbGVEaXN0cmljdHNGb3VuZDogXCJGb3VuZCBtb3JlIHRoYW4gb25lIGRpc3RyaWN0cyBtYXRjaGluZyB0aGlzIGFkZHJlc3NcIixcbiAgZGlzdHJpY3ROYW1lOiBmdW5jdGlvbihkaXN0cmljdE5hbWUpIHtcbiAgICByZXR1cm4gYFRoaXMgYWRkcmVzcyBpcyBpbiAke2Rpc3RyaWN0TmFtZX0uYDtcbiAgfSxcbiAgb2ZmaWNpYWxOYW1lOiBmdW5jdGlvbihvZmZpY2lhbE5hbWUpIHtcbiAgICByZXR1cm4gYFRoZSByZXByZXNlbnRhdGl2ZSBmb3IgdGhpcyBkaXN0cmljdCBpcyAke29mZmljaWFsTmFtZX0uYDtcbiAgfSxcbiAgYXZnTWVldGluZ3M6IGZ1bmN0aW9uKG51bU1lZXRpbmdzKSB7XG4gICAgY29uc3QgcyA9IG51bU1lZXRpbmdzID09IDEgPyAnJyA6ICdzJztcbiAgICByZXR1cm4gIGBUaGlzIHJlcHJlc2VudGF0aXZlIGhhcyBoZWxkICR7bnVtTWVldGluZ3N9IG1lZXRpbmcke3N9LCB0aGUgYXZlcmFnZSBmb3IgQXBwYWxhY2hpYW4gcmVwcmVzZW50YXRpdmVzLmA7XG4gIH0sXG4gIGFib3ZlQXZnTWVldGluZ3M6IGZ1bmN0aW9uKG51bU1lZXRpbmdzLCBhdmdNZWV0aW5ncykge1xuICAgIGNvbnN0IHMgPSBudW1NZWV0aW5ncyA9PSAxID8gJycgOiAncyc7XG4gICAgcmV0dXJuICBgVGhpcyByZXByZXNlbnRhdGl2ZSBoYXMgaGVsZCAke251bU1lZXRpbmdzfSBtZWV0aW5nJHtzfSwgbW9yZSB0aGFuIHRoZSBhdmVyYWdlIGZvciBBcHBhbGFjaGlhbiByZXByZXNlbnRhdGl2ZXMuYDtcbiAgfSxcbiAgYmVsb3dBdmdNZWV0aW5nczogZnVuY3Rpb24obnVtTWVldGluZ3MsIGF2Z01lZXRpbmdzKSB7XG4gICAgY29uc3QgcyA9IG51bU1lZXRpbmdzID09IDEgPyAnJyA6ICdzJztcbiAgICBjb25zdCBudW1NZWV0aW5nc1dvcmQgPSBudW1NZWV0aW5ncyA9PSAwID8gJ25vJyA6IG51bU1lZXRpbmdzO1xuICAgIHJldHVybiAgYFRoaXMgcmVwcmVzZW50YXRpdmUgaGFzIGhlbGQgJHtudW1NZWV0aW5nc1dvcmR9IG1lZXRpbmcke3N9LCBiZWxvdyB0aGUgYXZlcmFnZSBvZiAke2F2Z01lZXRpbmdzfSBmb3IgQXBwYWxhY2hpYW4gcmVwcmVzZW50YXRpdmVzLmA7XG4gIH1cbn07XG5cbmV4cG9ydCBjbGFzcyBBcHAge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5fdGltZWxpbmVDb250YWluZXIgPSBvcHRpb25zLnRpbWVsaW5lQ29udGFpbmVyO1xuICAgIHRoaXMuX3JlcFNlYXJjaENvbnRhaW5lciA9IG9wdGlvbnMucmVwU2VhcmNoQ29udGFpbmVyO1xuICAgIHRoaXMuX3JlcENvbnRleHRDb250YWluZXIgPSBvcHRpb25zLnJlcENvbnRleHRDb250YWluZXI7XG4gICAgdGhpcy5fZ29vZ2xlQXBpS2V5ID0gb3B0aW9ucy5nb29nbGVBcGlLZXk7XG4gICAgdGhpcy5fbGFiZWxzID0gb3B0aW9ucy5sYWJlbHMgfHwgREVGQVVMVF9MQUJFTFM7XG4gICAgdGhpcy5fbWVldGluZ1N0b3JlID0gbmV3IE1lZXRpbmdTdG9yZSgpO1xuICAgIHRoaXMuX3N0YXJ0RGF0ZSA9IG9wdGlvbnMuc3RhcnREYXRlIHx8IG5ldyBEYXRlKDIwMTcsIDAsIDIwKTtcbiAgICB0aGlzLl9lbmREYXRlID0gb3B0aW9ucy5lbmREYXRlIHx8IG5ldyBEYXRlKCk7XG4gICAgdGhpcy5fYW5ub3RhdGlvbnMgPSBvcHRpb25zLmFubm90YXRpb25zIHx8IHtcbiAgICAgIFwiMjAxNy0wMS0yMFwiOiB7XG4gICAgICAgIGxhYmVsOiBcIkluYXVndXJhdGlvbiBkYXlcIlxuICAgICAgfSxcbiAgICAgIFwiMjAxNy0wMi0yMFwiOiB7XG4gICAgICAgIGxhYmVsOiBcIkRpc3RyaWN0IHdvcmsgcGVyaW9kIGJlZ2luc1wiXG4gICAgICB9LFxuICAgICAgXCIyMDE3LTAyLTI0XCI6IHtcbiAgICAgICAgbGFiZWw6IFwiRGlzdHJpY3Qgd29yayBwZXJpb2QgZW5kc1wiXG4gICAgICB9LFxuICAgICAgXCIyMDE3LTA0LTEwXCI6IHtcbiAgICAgICAgbGFiZWw6IFwiRGlzdHJpY3Qgd29yayBwZXJpb2QgYmVnaW5zXCJcbiAgICAgIH0sXG4gICAgICBcIjIwMTctMDQtMjFcIjoge1xuICAgICAgICBsYWJlbDogXCJEaXN0cmljdCB3b3JrIHBlcmlvZCBlbmRzXCJcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gRXhwbGljaXRlbHkgYmluZCB0aGlzIG1ldGhvZCB0byB0aGUgaW5zdGFuY2Ugc28gdGhhdCB3ZSBjYW4gYWNjZXNzXG4gICAgLy8gYHRoaXNgIHdoZW4gdGhlIG1ldGhvZCBpcyB1c2VkIGFzIGEgY2FsbGJhY2tcbiAgICB0aGlzLl9oYW5kbGVBZGRyZXNzID0gdGhpcy5faGFuZGxlQWRkcmVzcy5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX2hhbmRsZVJlc2V0ID0gdGhpcy5faGFuZGxlUmVzZXQuYmluZCh0aGlzKTtcblxuICAgIC8vIENvbnN0cnVjdCBzb21lIGQzIGNvbXBvbmVudHNcbiAgICB0aGlzLl90aW1lbGluZSA9IG1lZXRpbmdUaW1lbGluZSgpO1xuICAgIHRoaXMuX3NlYXJjaCA9IHJlcFNlYXJjaCgpXG4gICAgICAuaGFuZGxlQWRkcmVzcyh0aGlzLl9oYW5kbGVBZGRyZXNzKVxuICAgICAgLmhhbmRsZVJlc2V0KHRoaXMuX2hhbmRsZVJlc2V0KTtcbiAgICB0aGlzLl9jb250ZXh0ID0gcmVwQ29udGV4dCgpXG4gICAgICAubGFiZWxzKHRoaXMuX2xhYmVscyk7XG5cbiAgICAvLyBUaGVzZSBhcmUgdGhlIHN0YXRlIHZhcmlhYmxlc1xuICAgIHRoaXMuX2FsbERheXMgPSBbXTtcbiAgICB0aGlzLl9zZWFyY2hBZGRyZXNzID0gbnVsbDtcblxuICAgIGQzLmpzb24ob3B0aW9ucy5vZmZpY2lhbE1lZXRpbmdzSnNvblVybCwgZGF0YSA9PiB7XG4gICAgICB0aGlzLl9tZWV0aW5nU3RvcmUuc2V0T2ZmaWNpYWxzKGRhdGEub2JqZWN0cyk7XG4gICAgICB0aGlzLl9hbGxEYXlzID0gdGhpcy5fbWVldGluZ3NCeURheShcbiAgICAgICAgdGhpcy5fbWVldGluZ1N0b3JlLFxuICAgICAgICB0aGlzLl9zdGFydERhdGUsXG4gICAgICAgIHRoaXMuX2VuZERhdGUsXG4gICAgICAgIHRoaXMuX2Fubm90YXRpb25zXG4gICAgICApO1xuXG4gICAgICB0aGlzLl9yZW5kZXJUaW1lbGluZSh0aGlzLl9hbGxEYXlzKTtcblxuICAgICAgZDMuc2VsZWN0KHRoaXMuX3JlcFNlYXJjaENvbnRhaW5lcilcbiAgICAgICAgLmNhbGwodGhpcy5fc2VhcmNoKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9oYW5kbGVSZXNldCgpIHtcbiAgICBpZiAodGhpcy5fc2VhcmNoQWRkcmVzcyAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5fcmVuZGVyVGltZWxpbmUodGhpcy5fYWxsRGF5cyk7XG4gICAgICBkMy5zZWxlY3QodGhpcy5fcmVwQ29udGV4dENvbnRhaW5lcilcbiAgICAgICAgLmRhdHVtKG51bGwpXG4gICAgICAgIC5jYWxsKHRoaXMuX2NvbnRleHQpO1xuICAgIH1cbiAgfVxuXG4gIF9yZW5kZXJUaW1lbGluZShkYXlzKSB7XG4gICAgZDMuc2VsZWN0KHRoaXMuX3RpbWVsaW5lQ29udGFpbmVyKVxuICAgICAgLmRhdHVtKGRheXMpXG4gICAgICAuY2FsbCh0aGlzLl90aW1lbGluZSk7XG4gIH1cblxuICBfaGFuZGxlQWRkcmVzcyhhZGRyZXNzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3NlYXJjaEFkZHJlc3MgPSBhZGRyZXNzO1xuXG4gICAgLy8gVXNlIHRoZSBHb29nbGUgQ2l2aWMgSW5mb3JtYXRpb24gQVBJIHRvIGxvb2t1cCB0aGUgVS5TLiBSZXByZXNlbnRhdGl2ZVxuICAgIC8vIGZvciBhbiBhZGRyZXNzLlxuICAgIC8vXG4gICAgLy8gU2VlIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2NpdmljLWluZm9ybWF0aW9uL2RvY3MvdjIvcmVwcmVzZW50YXRpdmVzL3JlcHJlc2VudGF0aXZlSW5mb0J5QWRkcmVzc1xuICAgIC8vIGZvciBBUEkgZG9jcy5cbiAgICAvLyBBIGZldyBxdWljayBub3RlczpcbiAgICAvL1xuICAgIC8vIFdlIGp1c3QgbmVlZCB0byBsb29rIHVwIHJlcHMgYnkgdGhlaXIgZGlzdHJpY3QsIHNvIHdlIGp1c3QgbmVlZCB0aGVcbiAgICAvLyBwb2xpdGljYWwgZGl2aXNpb24gYW5kIG5vdCBkYXRhIGFib3V0IG9mZmljZXMuICBXZSBleGNsdWRlIG9mZmljZSBkYXRhXG4gICAgLy8gYnkgc3BlY2lmeWluZyBgaW5jbHVkZU9mZmljZXM9ZmFsc2VgXG4gICAgLy9cbiAgICAvLyBgbGV2ZWxzPWNvdW50cnlgIGFuZCBgcm9sZXM9bGVnaXNsYXRvckxvd2VyQm9keWAgc3BlY2lmaWVzIHRoYXQgd2Ugb25seVxuICAgIC8vIGNhcmUgYWJvdXQgdGhlIGhvdXNlLlxuICAgIGNvbnN0IHVybCA9IGBodHRwczovL2NvbnRlbnQuZ29vZ2xlYXBpcy5jb20vY2l2aWNpbmZvL3YyL3JlcHJlc2VudGF0aXZlcz9hZGRyZXNzPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGFkZHJlc3MpfSZpbmNsdWRlT2ZmaWNlcz1mYWxzZSZsZXZlbHM9Y291bnRyeSZyb2xlcz1sZWdpc2xhdG9yTG93ZXJCb2R5JmFsdD1qc29uJmtleT0ke3RoaXMuX2dvb2dsZUFwaUtleX1gO1xuXG4gICAgZDMuanNvbih1cmwsIGRhdGEgPT4ge1xuICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgICBtc2c6IHRoaXMuX2xhYmVscy5ub0Rpc3RyaWN0Rm91bmRcbiAgICAgICAgfSwgbnVsbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIC8vIERpdmlzaW9ucyBpcyBhbiBvYmplY3Qga2V5ZWQgYnkgT0NEIElELiBXZSBuZWVkIGEgbGlzdCBvZiB0aGVzZSBJRHMuXG4gICAgICBjb25zdCBkaXZpc2lvbnMgPSBPYmplY3Qua2V5cyhkYXRhLmRpdmlzaW9ucyk7XG5cbiAgICAgIC8vIFRoZXJlIHNob3VsZCBiZSBvbmUgYW5kIG9ubHkgb25lIGNvbmdyZXNzaW9uYWwgZGlzdHJpY3QgZm9yIGFuIGFkZHJlc3NcbiAgICAgIGlmIChkaXZpc2lvbnMubGVuZ3RoICE9IDEpIHtcbiAgICAgICAgY2FsbGJhY2soe1xuICAgICAgICAgIG1zZzogZGl2aXNpb24ubGVuZ3RoID09IDAgPyB0aGlzLl9sYWJlbHMubm9EaXN0cmljdEZvdW5kIDogdGhpcy5fbGFiZWxzLm11bHRpcGxlRGlzdHJpY3RzRm91bmRcbiAgICAgICAgfSwgbnVsbCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN1Y2Nlc3NcbiAgICAgIGNvbnN0IG9jZElkID0gZGl2aXNpb25zWzBdO1xuICAgICAgY29uc3QgZGlzdHJpY3ROYW1lID0gZGF0YS5kaXZpc2lvbnNbb2NkSWRdLm5hbWU7XG5cbiAgICAgIC8vIFRlbGwgdGhlIGZvcm1cbiAgICAgIGNhbGxiYWNrKG51bGwsIHt9KTtcblxuICAgICAgY29uc3QgbWVldGluZ3NGb3JEaXZpc2lvbiA9IHRoaXMuX21lZXRpbmdTdG9yZS5nZXRNZWV0aW5nc0ZvckRpdmlzaW9uKGRpdmlzaW9uc1swXSk7XG4gICAgICBjb25zdCBtZWV0aW5nSWRzID0gbWVldGluZ3NGb3JEaXZpc2lvbi5yZWR1Y2UoKGxvb2t1cCwgbWVldGluZykgPT4ge1xuICAgICAgICBsb29rdXBbbWVldGluZy5pZF0gPSB0cnVlO1xuICAgICAgICByZXR1cm4gbG9va3VwO1xuICAgICAgfSwge30pO1xuXG4gICAgICBkMy5zZWxlY3QodGhpcy5fcmVwQ29udGV4dENvbnRhaW5lcilcbiAgICAgICAgLmRhdHVtKHtcbiAgICAgICAgICBvZmZpY2lhbDogdGhpcy5fbWVldGluZ1N0b3JlLmdldE9mZmljaWFsRm9yRGl2aXNpb24ob2NkSWQpLFxuICAgICAgICAgIG51bU1lZXRpbmdzOiBtZWV0aW5nc0ZvckRpdmlzaW9uLmxlbmd0aCxcbiAgICAgICAgICBhdmdNZWV0aW5nczogdGhpcy5fbWVldGluZ1N0b3JlLmdldEF2Z01lZXRpbmdzKCksXG4gICAgICAgICAgZGlzdHJpY3ROYW1lOiBkaXN0cmljdE5hbWVcbiAgICAgICAgfSlcbiAgICAgICAgLmNhbGwodGhpcy5fY29udGV4dCk7XG5cbiAgICAgIGNvbnN0IGRheXMgPSB0aGlzLl9tZWV0aW5nc0J5RGF5KFxuICAgICAgICB0aGlzLl9tZWV0aW5nU3RvcmUsXG4gICAgICAgIHRoaXMuX3N0YXJ0RGF0ZSxcbiAgICAgICAgdGhpcy5fZW5kRGF0ZSxcbiAgICAgICAgdGhpcy5fYW5ub3RhdGlvbnMsXG4gICAgICAgIG1lZXRpbmcgPT4gbWVldGluZ0lkc1ttZWV0aW5nLmlkXVxuICAgICAgKTtcbiAgICAgIHRoaXMuX3JlbmRlclRpbWVsaW5lKGRheXMpO1xuICAgIH0pO1xuICB9XG5cbiAgX21lZXRpbmdzQnlEYXkobWVldGluZ1N0b3JlLCBzdGFydERhdGUsIGVuZERhdGUsIGFubm90YXRpb25zLCBmaWx0ZXIpIHtcbiAgICBjb25zdCBkYXlzID0gW107XG4gICAgY29uc3QgZm9ybWF0ID0gZDMudGltZUZvcm1hdChcIiVZLSVtLSVkXCIpO1xuXG4gICAgZDMudGltZURheS5yYW5nZShzdGFydERhdGUsIGVuZERhdGUsIDEpXG4gICAgICAuZm9yRWFjaCgoZGF0ZSwgaSkgPT4ge1xuICAgICAgICBjb25zdCBkYXRlU3RyID0gZm9ybWF0KGRhdGUpO1xuICAgICAgICBjb25zdCBtZWV0aW5ncyA9IG1lZXRpbmdTdG9yZS5nZXRNZWV0aW5nc0ZvckRhdGUoZGF0ZVN0ciwgZmlsdGVyKTtcblxuICAgICAgICBpZiAobWVldGluZ3MubGVuZ3RoID09IDAgJiYgIWFubm90YXRpb25zW2RhdGVTdHJdKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF5cy5wdXNoKHtcbiAgICAgICAgICBkYXk6IGkrMSxcbiAgICAgICAgICBkYXRlOiBkYXRlLFxuICAgICAgICAgIG1lZXRpbmdzOiBtZWV0aW5ncyxcbiAgICAgICAgICBsYWJlbDogYW5ub3RhdGlvbnNbZGF0ZVN0cl0gPyBhbm5vdGF0aW9uc1tkYXRlU3RyXS5sYWJlbCA6IG51bGxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIHJldHVybiBkYXlzLnJldmVyc2UoKTtcbiAgfVxufVxuIiwiaW1wb3J0ICogYXMgZDMgZnJvbSBcImQzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlcENvbnRleHQoKSB7XG4gIGxldCBsYWJlbHMgPSB7fTtcblxuICBsZXQgY29udGV4dCA9IGZ1bmN0aW9uKHNlbGVjdGlvbikge1xuICAgIHNlbGVjdGlvbi5lYWNoKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIGNvbnN0IHNlbCA9IGQzLnNlbGVjdCh0aGlzKTtcblxuICAgICAgc2VsLnNlbGVjdEFsbCgnKicpLnJlbW92ZSgpO1xuXG4gICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBlbCA9IHNlbC5hcHBlbmQoJ2RpdicpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdyZXByZXNlbnRhdGl2ZS1jb250ZXh0Jyk7XG5cbiAgICAgIGlmIChkYXRhLmRpc3RyaWN0TmFtZSkge1xuICAgICAgICBlbC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgIC50ZXh0KGxhYmVscy5kaXN0cmljdE5hbWUoZGF0YS5kaXN0cmljdE5hbWUpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEub2ZmaWNpYWwpIHtcbiAgICAgICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAudGV4dChsYWJlbHMub2ZmaWNpYWxOYW1lKGRhdGEub2ZmaWNpYWwubmFtZSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGF0YS5udW1NZWV0aW5ncyA9PSBkYXRhLmF2Z01lZXRpbmdzKSB7XG4gICAgICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgICAgLnRleHQobGFiZWxzLmF2Z01lZXRpbmdzKGRhdGEubnVtTWVldGluZ3MpKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGRhdGEubnVtTWVldGluZ3MgPiBkYXRhLmF2Z01lZXRpbmdzKSB7XG4gICAgICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgICAgLnRleHQobGFiZWxzLmFib3ZlQXZnTWVldGluZ3MoZGF0YS5udW1NZWV0aW5ncywgZGF0YS5hdmdNZWV0aW5ncykpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGVsLmFwcGVuZCgnc3BhbicpXG4gICAgICAgICAgLnRleHQobGFiZWxzLmJlbG93QXZnTWVldGluZ3MoZGF0YS5udW1NZWV0aW5ncywgZGF0YS5hdmdNZWV0aW5ncykpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIGNvbnRleHQubGFiZWxzID0gZnVuY3Rpb24odmFsKSB7XG4gICAgaWYgKCF2YWwpIHsgcmV0dXJuIGxhYmVsczsgfVxuXG4gICAgbGFiZWxzID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmV0dXJuIGNvbnRleHQ7XG59XG4iLCJpbXBvcnQgKiBhcyBkMyBmcm9tIFwiZDNcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVwU2VhcmNoKCkge1xuICBsZXQgaGFuZGxlQWRkcmVzcyA9IGZ1bmN0aW9uKCkge307XG4gIGxldCBoYW5kbGVSZXNldCA9IGZ1bmN0aW9uKCkge307XG4gIGxldCBtZXNzYWdlcyA9IG51bGw7XG5cbiAgbGV0IHJlY2VpdmVSZXNwb25zZSA9IGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIG1lc3NhZ2VzLnRleHQoZXJyLm1zZyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbWVzc2FnZXMudGV4dChcIlwiKTtcbiAgfTtcblxuICBsZXQgaGFuZGxlU3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgZDMuZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIGNvbnN0IGZvcm0gPSBkMy5zZWxlY3QoZDMuZXZlbnQudGFyZ2V0KTtcbiAgICBjb25zdCBhZGRyZXNzID0gZm9ybS5zZWxlY3QoJy5yZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybV9fYWRkcmVzcy1pbnB1dCcpLm5vZGUoKS52YWx1ZTtcblxuICAgIGlmICghYWRkcmVzcykge1xuICAgICAgLy8gRG9uJ3QgYWxsb3cgYW4gZW1wdHkgYWRkcmVzc1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIG1lc3NhZ2VzID0gZm9ybS5zZWxlY3QoJy5yZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybV9fbWVzc2FnZXMnKTtcbiAgICBoYW5kbGVBZGRyZXNzKGFkZHJlc3MsIHJlY2VpdmVSZXNwb25zZSk7XG4gIH07XG5cbiAgY29uc3Qgc2VhcmNoID0gZnVuY3Rpb24oc2VsZWN0aW9uKSB7XG4gICAgc2VsZWN0aW9uLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBzZWwgPSBkMy5zZWxlY3QodGhpcyk7XG5cbiAgICAgIHNlbC5zZWxlY3RBbGwoJyonKS5yZW1vdmUoKTtcblxuICAgICAgY29uc3QgZm9ybSA9IHNlbC5hcHBlbmQoJ2Zvcm0nKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdyZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybScpXG4gICAgICAgICAgLm9uKCdzdWJtaXQnLCBoYW5kbGVTdWJtaXQpO1xuXG4gICAgICBmb3JtLmFwcGVuZCgnaW5wdXQnKVxuICAgICAgICAgIC5hdHRyKCd0eXBlJywgJ3RleHQnKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdyZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybV9fYWRkcmVzcy1pbnB1dCcpXG4gICAgICAgICAgLmF0dHIoJ3BsYWNlaG9sZGVyJywgXCJFbnRlciB5b3VyIGFkZHJlc3NcIik7XG5cbiAgICAgIGZvcm0uYXBwZW5kKCdidXR0b24nKVxuICAgICAgICAgIC5hdHRyKCd0eXBlJywgJ3N1Ym1pdCcpXG4gICAgICAgICAgLnRleHQoXCJGaW5kIHlvdXIgcmVwcmVzZW50YXRpdmVcIilcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAncmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm1fX2J0biByZXByZXNlbnRhdGl2ZS1zZWFyY2gtZm9ybV9fYnRuLS1zdWJtaXQnKTtcblxuICAgICAgZm9ybS5hcHBlbmQoJ2J1dHRvbicpXG4gICAgICAgICAgLmF0dHIoJ3R5cGUnLCAncmVzZXQnKVxuICAgICAgICAgIC50ZXh0KFwiU3RhcnQgb3ZlclwiKVxuICAgICAgICAgIC5vbignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBtZXNzYWdlcy50ZXh0KFwiXCIpO1xuICAgICAgICAgICAgbWVzc2FnZXMuc2VsZWN0QWxsKCcqJykucmVtb3ZlKCk7XG4gICAgICAgICAgICBoYW5kbGVSZXNldCgpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3JlcHJlc2VudGF0aXZlLXNlYXJjaC1mb3JtX19idG4gcmVwcmVzZW50YXRpdmUtc2VhcmNoLWZvcm1fX2J0bi0tcmVzZXQnKTtcblxuICAgICAgZm9ybS5hcHBlbmQoJ2RpdicpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3JlcHJlc2VudGF0aXZlLXNlYXJjaC1mb3JtX19tZXNzYWdlcycpO1xuICAgIH0pO1xuICB9XG5cbiAgc2VhcmNoLmhhbmRsZUFkZHJlc3MgPSBmdW5jdGlvbih2YWwpIHtcbiAgICBpZiAoIXZhbCkgeyByZXR1cm4gaGFuZGxlQWRkcmVzczsgfVxuXG4gICAgaGFuZGxlQWRkcmVzcyA9IHZhbDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNlYXJjaC5oYW5kbGVSZXNldCA9IGZ1bmN0aW9uKHZhbCkge1xuICAgIGlmICghdmFsKSB7IHJldHVybiBoYW5kbGVSZXNldDsgfVxuXG4gICAgaGFuZGxlUmVzZXQgPSB2YWw7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICByZXR1cm4gc2VhcmNoO1xufVxuIiwiaW1wb3J0ICogYXMgZDMgZnJvbSBcImQzXCI7XG5cbmZ1bmN0aW9uIG9jZElkVG9EaXN0cmljdChvY2RJZCkge1xuICBjb25zdCBiaXRzID0gb2NkSWQuc3BsaXQoJzonKTtcbiAgY29uc3Qgc3RhdGUgPSBiaXRzW2JpdHMubGVuZ3RoIC0gMl0uc2xpY2UoMCwgMikudG9VcHBlckNhc2UoKTtcbiAgY29uc3QgZGlzdHJpY3QgPSBiaXRzW2JpdHMubGVuZ3RoIC0gMV07XG4gIHJldHVybiBzdGF0ZSArIFwiLVwiICsgZGlzdHJpY3Q7XG59XG5cbmZ1bmN0aW9uIG9mZmljaWFsRGlzdHJpY3Qob2ZmaWNpYWwpIHtcbiAgcmV0dXJuIG9jZElkVG9EaXN0cmljdChvZmZpY2lhbC5vZmZpY2UuZGl2aXNpb24ub2NkX2lkKTtcbn1cblxuZnVuY3Rpb24gbWVldGluZ3NCeU9mZmljaWFsKG1lZXRpbmdzKSB7XG4gIGNvbnN0IGJ5T2ZmaWNpYWwgPSBtZWV0aW5ncy5yZWR1Y2UoKGxvb2t1cCwgbWVldGluZykgPT4ge1xuICAgIGlmICghbG9va3VwW21lZXRpbmcub2ZmaWNpYWwuaWRdKSB7XG4gICAgICBsb29rdXBbbWVldGluZy5vZmZpY2lhbC5pZF0gPSB7XG4gICAgICAgIG9mZmljaWFsOiBtZWV0aW5nLm9mZmljaWFsLFxuICAgICAgICBtZWV0aW5nczogW11cbiAgICAgIH07XG4gICAgfVxuICAgIGxvb2t1cFttZWV0aW5nLm9mZmljaWFsLmlkXS5tZWV0aW5ncy5wdXNoKG1lZXRpbmcpO1xuICAgIHJldHVybiBsb29rdXA7XG4gIH0sIHt9KTtcblxuICByZXR1cm4gZDMudmFsdWVzKGJ5T2ZmaWNpYWwpO1xufVxuXG5mdW5jdGlvbiBnZXRQYXJ0eUxhYmVsKHBhcnR5KSB7XG4gIGlmIChwYXJ0eSA9PSBcIlJlcHVibGljYW5cIikge1xuICAgIHJldHVybiBcIlJcIjtcbiAgfVxuICBlbHNlIGlmIChwYXJ0eSA9PSBcIkRlbW9jcmF0aWNcIikge1xuICAgIHJldHVybiBcIkRcIjtcbiAgfVxufVxuXG5mdW5jdGlvbiByZW5kZXJPZmZpY2lhbChzZWwpIHtcbiAgc2VsLmVhY2goZnVuY3Rpb24oZCkge1xuICAgIGNvbnN0IGVsID0gZDMuc2VsZWN0KHRoaXMpO1xuXG4gICAgY29uc3QgcGFydHlMYWJlbCA9IGdldFBhcnR5TGFiZWwoZC5vZmZpY2lhbC5wYXJ0eSk7XG4gICAgbGV0IG9mZmljaWFsQ2xhc3MgPSBcInRpbWVsaW5lX19tZWV0aW5nX19vZmZpY2lhbFwiO1xuICAgIGlmIChwYXJ0eUxhYmVsKSB7XG4gICAgICBvZmZpY2lhbENsYXNzICs9IFwiIHRpbWVsaW5lX19tZWV0aW5nX19vZmZpY2lhbC0tXCIgKyBwYXJ0eUxhYmVsLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgb2ZmaWNpYWxDbGFzcylcbiAgICAgICAgLnRleHQoZC5vZmZpY2lhbC5uYW1lKTtcblxuICAgIGlmIChwYXJ0eUxhYmVsKSB7XG4gICAgICBlbC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fbWVldGluZ19fcGFydHkgdGltZWxpbmVfX21lZXRpbmdfX3BhcnR5LS0nICsgcGFydHlMYWJlbC50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgIC50ZXh0KFwiIChcIiArIHBhcnR5TGFiZWwgKyBcIilcIik7XG4gICAgfVxuXG4gICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lX19tZWV0aW5nX19kaXN0cmljdCcpXG4gICAgICAgIC50ZXh0KFwiIChcIiArIG9mZmljaWFsRGlzdHJpY3QoZC5vZmZpY2lhbCkgKyBcIilcIik7XG5cbiAgICBpZiAoZC5tZWV0aW5ncy5sZW5ndGggPT0gMSkge1xuICAgICAgaWYgKGQubWVldGluZ3NbMF0ubWVldGluZ190eXBlID09IFwidGVsZXBob25lXCIpIHtcbiAgICAgICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fbWVldGluZ19fdHlwZSB0aW1lbGluZV9fbWVldGluZ19fdHlwZS0tdGVsZXBob25lJylcbiAgICAgICAgICAgIC50ZXh0KFwiIFxcdTI2MEVcIik7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChkLm1lZXRpbmdzWzBdLm1lZXRpbmdfdHlwZSA9PSBcImZhY2Vib29rXCIpIHtcbiAgICAgICAgZWwuYXBwZW5kKCdzcGFuJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fbWVldGluZ19fdHlwZSB0aW1lbGluZV9fbWVldGluZ19fdHlwZS0tZmFjZWJvb2snKVxuICAgICAgICAgICAgLnRleHQoXCIgZlwiKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGQubWVldGluZ3NbMF0ubWVldGluZ190eXBlID09IFwicmFkaW9cIikge1xuICAgICAgICBlbC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVsaW5lX19tZWV0aW5nX190eXBlIHRpbWVsaW5lX19tZWV0aW5nX190eXBlLS1yYWRpbycpXG4gICAgICAgICAgICAudGV4dChcIiBcXHUxRjRGQlwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZC5tZWV0aW5ncy5sZW5ndGggPiAxKSB7XG4gICAgICBlbC5hcHBlbmQoJ3NwYW4nKVxuICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fbWVldGluZ19fY291bnQnKVxuICAgICAgICAgIC50ZXh0KFwiIHhcIiArIGQubWVldGluZ3MubGVuZ3RoKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZW5kZXJEYXkoc2VsLCBkYXRlRm9ybWF0KSB7XG4gIHNlbC5hcHBlbmQoJ2gyJylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX2RheV9fbnVtYmVyJylcbiAgICAudGV4dChkID0+IGQuZGF5KTtcblxuICBzZWwuYXBwZW5kKCdkaXYnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lbGluZV9fZGF5X19kYXRlJylcbiAgICAudGV4dChkID0+IGRhdGVGb3JtYXQoZC5kYXRlKSk7XG5cbiAgc2VsLmFwcGVuZCgnZGl2JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX2RheV9fbGFiZWwnKVxuICAgIC50ZXh0KGQgPT4gZC5sYWJlbCk7XG5cbiAgc2VsLnNlbGVjdEFsbCgnLnRpbWVsaW5lX19tZWV0aW5nJylcbiAgICAuZGF0YShkID0+IG1lZXRpbmdzQnlPZmZpY2lhbChkLm1lZXRpbmdzKSlcbiAgICAuZW50ZXIoKS5hcHBlbmQoJ2RpdicpXG4gICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX21lZXRpbmcnKVxuICAgICAgLmNhbGwocmVuZGVyT2ZmaWNpYWwpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBtZWV0aW5nVGltZWxpbmUoKSB7XG4gIGxldCBkYXRlRm9ybWF0ID0gZDMudGltZUZvcm1hdChcIiVCICVkLCAlWVwiKTtcblxuICBmdW5jdGlvbiB0aW1lbGluZShzZWxlY3Rpb24pIHtcbiAgICBzZWxlY3Rpb24uZWFjaChmdW5jdGlvbihkYXlzKSB7XG4gICAgICBjb25zdCBjb250YWluZXIgPSBkMy5zZWxlY3QodGhpcyk7XG4gICAgICBjb250YWluZXIuc2VsZWN0QWxsKCcqJykucmVtb3ZlKCk7XG5cbiAgICAgIGNvbnN0IHRpbWVsaW5lID0gY29udGFpbmVyLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmUnKTtcblxuICAgICAgdGltZWxpbmUuc2VsZWN0QWxsKCcudGltZWxpbmVfX2RheScpXG4gICAgICAgIC5kYXRhKGRheXMpXG4gICAgICAgIC5lbnRlcigpLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAndGltZWxpbmVfX2RheScpXG4gICAgICAgICAgLmNhbGwocmVuZGVyRGF5LCBkYXRlRm9ybWF0KTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB0aW1lbGluZTtcbn1cbiJdfQ==
